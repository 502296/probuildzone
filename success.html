<!doctype html>

<html lang="en">

<head>

  <meta charset="utf-8">

  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Payment Successful – ProBuildZone</title>

  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

  <style>

    :root{

      --bg: #0f2a43;      /* خلفية الصفحة */

      --card:#122c46;     /* بطاقة */

      --text:#ffffff;     /* نص */

      --muted: rgba(255,255,255,.85);

      --btn: #f28c1b;     /* زر العودة */

      --btnTxt:#0f2a43;

      --accent:#f4c045;   /* الذهبي لرابط الإيميل */

      --accent-hover:#ffd876;

    }

    *{box-sizing:border-box}

    html,body{height:100%}

    body{

      margin:0; font-family:Inter, system-ui, Arial;

      background: var(--bg); color:var(--text);

      display:grid; place-items:center; min-height:100vh;

    }

    .card{

      background:var(--card);

      padding:28px 32px; border-radius:14px;

      max-width:640px; width:min(92vw,640px);

      box-shadow:0 12px 28px rgba(0,0,0,.35);

    }

    h1{margin:0 0 10px; font-size:26px}

    p{margin:0 0 6px; line-height:1.6; color:var(--muted)}

    a{color:inherit; text-decoration:none}

    .email{

      color:var(--accent);

      font-weight:700;

    }

    .email:hover{ color:var(--accent-hover); text-decoration:underline }

    .btn{

      display:inline-block; margin-top:14px;

      padding:10px 16px; border-radius:10px;

      background:var(--btn); color:var(--btnTxt);

      font-weight:700;

    }

    .status{ margin-top:8px; font-size:14px; opacity:.9 }

    .status.error{ color:#ffd3d3 }

    .sr-only{position:absolute;left:-9999px}

  </style>

</head>

<body>

  <div class="card">

    <h1>🎉 You’re in!</h1>

    <p>Thanks for starting your 30-day free trial. We’ve received your details and payment setup via Stripe.</p>

    <p>If you need help, email <a class="email" href="mailto:contact@probuildzone.com">contact@probuildzone.com</a>.</p>

    <p id="status" class="status" role="status" aria-live="polite">Saving your subscription to our records…</p>

    <a class="btn" href="/index.html">Back to Home</a>

  </div>



  <!-- Save to Google Sheet via Netlify Function -->

  <script>

    (function () {

      // 1) احصل على session_id من رابط Stripe

      const sessionId = new URL(location.href).searchParams.get('session_id') || '';



      // 2) استرجع بيانات النموذج المخزّنة من pros.html

      let formData = {};

      try { formData = JSON.parse(sessionStorage.getItem('pbz_profile') || '{}'); } catch (_) {}



      // 3) جهّز الحمولة

      const payload = {

        ...formData,                    // { biz,name,email,phone,address,license,insurance,notes,status }

        stripe_customer_id: '',         // سيُملأ لاحقًا عبر webhook

        stripe_subscription_id: '',     // سيُملأ لاحقًا عبر webhook

        session_id: sessionId

      };



      const statusEl = document.getElementById('status');



      // 4) أرسل إلى Netlify Function

      fetch('/.netlify/functions/save-profile', {

        method: 'POST',

        headers: { 'Content-Type': 'application/json' },

        body: JSON.stringify(payload)

      })

      .then(async (r) => {

        const text = await r.text().catch(()=>'');

        if (!r.ok) throw new Error(`save-profile failed (${r.status}): ${text.slice(0,200)}`);

        statusEl.textContent = 'Saved to Google Sheet ✅';

        // تنظيف التخزين لمنع التكرار عند الرجوع/إعادة التحميل

        sessionStorage.removeItem('pbz_profile');

        console.log('✅ Saved to Sheet');

      })

      .catch((err) => {

        console.warn(err);

        statusEl.textContent = 'Could not save to Sheet. Please contact support.';

        statusEl.classList.add('error');

      });

    })();

  </script>

</body>

</html>
