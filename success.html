<script>

  // نفترض إنك خزنت بيانات الفورم قبل ما تروح لسترايب

  // مثلاً في pros.html عملت:

  // localStorage.setItem('pbz-pro', JSON.stringify(formData));



  async function savePro() {

    const saved = localStorage.getItem('pbz-pro');

    if (!saved) return;



    const proData = JSON.parse(saved);



    // لو رجع لك السترايب ids في الـsuccess URL تقدر تضيفهم هنا

    const urlParams = new URLSearchParams(window.location.search);

    const sc = urlParams.get('customer');

    const sub = urlParams.get('subscription');



    const res = await fetch('/.netlify/functions/save-pro', {

      method: 'POST',

      headers: { 'Content-Type': 'application/json' },

      body: JSON.stringify({

        ...proData,

        stripe_customer_id: sc,

        stripe_subscription_id: sub,

      }),

    });



    const json = await res.json();

    const statusEl = document.getElementById('save-status');



    if (json.ok) {

      statusEl.textContent = 'Your profile was saved successfully.';

      statusEl.style.color = '#58d68d';

      // ممكن تحب تحذفها من التخزين

      localStorage.removeItem('pbz-pro');

    } else {

      statusEl.textContent = 'We received your payment, but could not save your profile. Please email contact@probuildzone.com';

      statusEl.style.color = '#e74c3c';

    }

  }



  savePro();

</script>
