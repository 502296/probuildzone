<!doctype html>

<html lang="en">

<head>

  <meta charset="utf-8">

  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Payment Successful â€“ ProBuildZone</title>

  <style>

    body{font-family:Inter,system-ui,Arial;margin:0;background:#0f2a43;color:#fff;display:grid;place-items:center;min-height:100vh}

    .card{background:#122c46;padding:28px 32px;border-radius:14px;max-width:560px;box-shadow:0 12px 28px rgba(0,0,0,.3)}

    h1{margin:0 0 10px;font-size:26px}

    p{opacity:.9;line-height:1.6}

    a.btn{display:inline-block;margin-top:14px;padding:10px 16px;border-radius:10px;background:#f28c1b;color:#0f2a43;text-decoration:none;font-weight:600}

    .muted{opacity:.8;font-size:14px}

  </style>

</head>

<body>

  <div class="card">

    <h1>ðŸŽ‰ Youâ€™re in!</h1>

    <p>Thanks for starting your 30-day free trial. Weâ€™ve received your details and payment setup via Stripe.</p>

    <p>If you need help, email <a href="mailto:contact@probuildzone.com">contact@probuildzone.com</a>.</p>

    <p id="status" class="muted">Saving your subscription to our recordsâ€¦</p>

    <a class="btn" href="/index.html">Back to Home</a>

  </div>



  <!-- Save to Google Sheet via Netlify Function -->

  <script>

    (function(){

      // 1) Get session_id from Stripe return URL

      const sessionId = new URL(location.href).searchParams.get('session_id') || '';



      // 2) Read the form data we stored in pros.html

      let formData = {};

      try {

        formData = JSON.parse(sessionStorage.getItem('pbz_profile') || '{}');

      } catch (_) {}



      // 3) Prepare payload â†’ save-profile.js expects flat keys

      //    We also keep status as `trial_active` as agreed.

      const payload = {

        ...formData,                    // { biz,name,email,phone,address,license,insurance,notes,status }

        stripe_customer_id: '',         // left empty now (can be filled later via webhook)

        stripe_subscription_id: '',     // left empty now (can be filled later via webhook)

        session_id: sessionId

      };



      // 4) Send to Netlify Function

      fetch('/.netlify/functions/save-profile', {

        method: 'POST',

        headers: { 'Content-Type': 'application/json' },

        body: JSON.stringify(payload)

      })

      .then(async (r) => {

        // try to parse but don't fail UX if no JSON returned

        try { await r.json(); } catch(_){}

        document.getElementById('status').textContent = 'Saved to Google Sheet âœ…';

        // clear storage to avoid duplicate submissions on reload/back

        sessionStorage.removeItem('pbz_profile');

        console.log('âœ… Saved to Sheet');

      })

      .catch((err) => {

        console.warn('Save to sheet failed:', err);

        document.getElementById('status').textContent =

          'Saved (queued). If you donâ€™t see it in the Sheet, refresh or contact support.';

      });

    })();

  </script>

</body>

</html>
