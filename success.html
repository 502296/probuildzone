<!doctype html>

<html lang="en">

<head>

  <meta charset="utf-8">

  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Payment Successful â€“ ProBuildZone</title>

  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

  <style>

    :root{

      --bg: #0f2a43;      /* Ø®Ù„ÙÙŠØ© Ø§Ù„ØµÙØ­Ø© */

      --card:#122c46;     /* Ø¨Ø·Ø§Ù‚Ø© */

      --text:#ffffff;     /* Ù†Øµ */

      --muted: rgba(255,255,255,.85);

      --btn: #f28c1b;     /* Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© */

      --btnTxt:#0f2a43;

      --accent:#f4c045;   /* Ø§Ù„Ø°Ù‡Ø¨ÙŠ Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ */

      --accent-hover:#ffd876;

    }

    *{box-sizing:border-box}

    html,body{height:100%}

    body{

      margin:0; font-family:Inter, system-ui, Arial;

      background: var(--bg); color:var(--text);

      display:grid; place-items:center; min-height:100vh;

    }

    .card{

      background:var(--card);

      padding:28px 32px; border-radius:14px;

      max-width:640px; width:min(92vw,640px);

      box-shadow:0 12px 28px rgba(0,0,0,.35);

    }

    h1{margin:0 0 10px; font-size:26px}

    p{margin:0 0 6px; line-height:1.6; color:var(--muted)}

    a{color:inherit; text-decoration:none}

    .email{

      color:var(--accent);

      font-weight:700;

    }

    .email:hover{ color:var(--accent-hover); text-decoration:underline }

    .btn{

      display:inline-block; margin-top:14px;

      padding:10px 16px; border-radius:10px;

      background:var(--btn); color:var(--btnTxt);

      font-weight:700;

    }

    .status{ margin-top:8px; font-size:14px; opacity:.9 }

    .status.error{ color:#ffd3d3 }

    .sr-only{position:absolute;left:-9999px}

  </style>

</head>

<body>

  <div class="card">

    <h1>ğŸ‰ Youâ€™re in!</h1>

    <p>Thanks for starting your 30-day free trial. Weâ€™ve received your details and payment setup via Stripe.</p>

    <p>If you need help, email <a class="email" href="mailto:contact@probuildzone.com">contact@probuildzone.com</a>.</p>

    <p id="status" class="status" role="status" aria-live="polite">Saving your subscription to our recordsâ€¦</p>

    <a class="btn" href="/index.html">Back to Home</a>

  </div>



  <!-- Save to Google Sheet via Netlify Function -->

  <script>

    (function () {

      // 1) Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ session_id Ù…Ù† Ø±Ø§Ø¨Ø· Stripe

      const sessionId = new URL(location.href).searchParams.get('session_id') || '';



      // 2) Ø§Ø³ØªØ±Ø¬Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ø®Ø²Ù‘Ù†Ø© Ù…Ù† pros.html

      let formData = {};

      try { formData = JSON.parse(sessionStorage.getItem('pbz_profile') || '{}'); } catch (_) {}



      // 3) Ø¬Ù‡Ù‘Ø² Ø§Ù„Ø­Ù…ÙˆÙ„Ø©

      const payload = {

        ...formData,                    // { biz,name,email,phone,address,license,insurance,notes,status }

        stripe_customer_id: '',         // Ø³ÙŠÙÙ…Ù„Ø£ Ù„Ø§Ø­Ù‚Ù‹Ø§ Ø¹Ø¨Ø± webhook

        stripe_subscription_id: '',     // Ø³ÙŠÙÙ…Ù„Ø£ Ù„Ø§Ø­Ù‚Ù‹Ø§ Ø¹Ø¨Ø± webhook

        session_id: sessionId

      };



      const statusEl = document.getElementById('status');



      // 4) Ø£Ø±Ø³Ù„ Ø¥Ù„Ù‰ Netlify Function

      fetch('/.netlify/functions/save-profile', {

        method: 'POST',

        headers: { 'Content-Type': 'application/json' },

        body: JSON.stringify(payload)

      })

      .then(async (r) => {

        const text = await r.text().catch(()=>'');

        if (!r.ok) throw new Error(`save-profile failed (${r.status}): ${text.slice(0,200)}`);

        statusEl.textContent = 'Saved to Google Sheet âœ…';

        // ØªÙ†Ø¸ÙŠÙ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ù„Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø± Ø¹Ù†Ø¯ Ø§Ù„Ø±Ø¬ÙˆØ¹/Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„

        sessionStorage.removeItem('pbz_profile');

        console.log('âœ… Saved to Sheet');

      })

      .catch((err) => {

        console.warn(err);

        statusEl.textContent = 'Could not save to Sheet. Please contact support.';

        statusEl.classList.add('error');

      });

    })();

  </script>

</body>

</html>
