<script>

  const payload = JSON.parse(localStorage.getItem('pbz_form_data') || '{}');



  fetch('/.netlify/functions/save-profile', {

    method: 'POST',

    headers: { 'Content-Type': 'application/json' },

    body: JSON.stringify(payload),

  })

    .then(async (res) => {

      const text = await res.text();

      console.log('Supabase response:', text);



      if (res.ok) {

        document.querySelector('.card').innerHTML = `

          <h2>✅ Saved successfully!</h2>

          <p>Your profile info has been saved to our system.</p>

          <a href="/" class="btn btn-gold">Back to Home</a>

        `;

      } else {

        document.querySelector('.card').innerHTML += `

          <p style="color:#f55;">⚠️ Could not save to Supabase. Please contact support.</p>

        `;

      }

    })

    .catch((err) => {

      console.error('Save error:', err);

      document.querySelector('.card').innerHTML += `

        <p style="color:#f55;">⚠️ Connection error while saving data.</p>

      `;

    });

</script>
