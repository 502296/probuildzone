<!DOCTYPE html>

<html lang="en">

<head>

  <meta charset="UTF-8"/>

  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <title>ProBuildZone ‚Äî Get Home Projects Done</title>

  <meta name="description" content="Post your project with photos. Local contractors send offers. You choose the best match ‚Äî fair prices, local pros.">

  <link rel="stylesheet" href="style.css"/>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

</head>

<body>



  <!-- Header / Navbar -->

  <header>

    <nav>

      <div class="brand-logo" aria-label="ProBuildZone">

        <span class="pro">Pro</span><span class="build">Build</span><span class="zone">Zone</span>

      </div>

      <ul>

        <li><a href="#links">Services</a></li>

        <li><a href="#pros" class="pro-btn">For Pros</a></li>

      </ul>

    </nav>

  </header>



  <!-- Hero -->

  <section class="hero">

    <div class="overlay">

      <h1>Get Home Projects Done ‚Äî Fair Prices, Local Pros.</h1>

      <p>Post your project with photos. Local contractors send offers. You choose the best match.</p>



      <div class="buttons">

        <button class="btn primary" id="postJobTop">Post a Job (Free)</button>

        <a href="#links" class="btn secondary">View Services</a>

        <button class="btn dark" id="checkOffers">Check Offer Prices</button>

      </div>



      <div class="job-id">

        <input id="jobIdQuick" type="text" placeholder="Enter Job ID (e.g., FH-99999)">

        <button id="goQuick">Go</button>

      </div>

    </div>

  </section>



  <!-- Footer links under hero -->

  <section id="links" class="links-row">

    <a href="services.html">Services</a><span>‚Ä¢</span>

    <a href="privacy.html">Privacy</a><span>‚Ä¢</span>

    <a href="terms.html">Terms</a>

  </section>



  <!-- ===== Upload Modal ===== -->

  <div class="modal" id="modal" style="display:none">

    <div class="sheet">

      <div class="sheet-head">

        <button class="btn xsm ghost back" id="backBtn">‚Üê Back</button>

        <h3 id="sheetTitle">Choose a category (12)</h3>

        <button class="btn xsm ghost" id="closeDoor">Close</button>

      </div>



      <!-- ÿ¥ÿ®ŸÉÿ© 12 ÿ£ŸäŸÇŸàŸÜÿ© -->

      <div class="grid" id="iconGrid"></div>



      <!-- ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿ±ŸÅÿπ + ÿßŸÑŸÜŸÖŸàÿ∞ÿ¨ (ÿ™ÿ∏Ÿáÿ± ÿ®ÿπÿØ ÿßÿÆÿ™Ÿäÿßÿ± ŸÅÿ¶ÿ©) -->

      <div id="uploaderArea" class="hidden">

        <h3 id="catTitle" class="cat-title"></h3>



        <!-- ÿ±ŸÅÿπ ÿßŸÑÿµŸàÿ± -->

        <div class="upload-wrap">

          <input type="file" id="fileInput" multiple accept="image/*"/>

          <button type="button" class="btn outline" id="pickBtn">

            <i class="fa-solid fa-cloud-arrow-up"></i> Choose Photos

          </button>

          <span class="hint">You can select multiple photos.</span>

        </div>

        <div class="card" id="fileList"></div>



        <!-- ŸÜŸÖŸàÿ∞ÿ¨ ÿµÿßÿ≠ÿ® ÿßŸÑŸÖŸÜÿ≤ŸÑ -->

        <div class="card form-wrap">

          <h4>Owner details & project info</h4>

          <p class="hint">Private fields are hidden from pros until you approve them.</p>



          <label>Project title *</label>

          <input id="title" required placeholder="e.g., Replace leaking roof"/>



          <label>Short summary</label>

          <textarea id="summary" placeholder="One or two lines‚Ä¶"></textarea>



          <div class="row2">

            <div><label>City</label><input id="city"/></div>

            <div><label>State</label><input id="state"/></div>

          </div>



          <div class="row2">

            <div><label>Budget min</label><input id="budgetMin" type="number"/></div>

            <div><label>Budget max</label><input id="budgetMax" type="number"/></div>

          </div>



          <hr class="sep">



          <div class="row2">

            <div><label>Contact name *</label><input id="contactName" required/></div>

            <div><label>Phone *</label><input id="phone" required inputmode="tel"/></div>

          </div>

          <label>Email *</label><input id="email" type="email" required inputmode="email"/>

          <label>Full address *</label><input id="address" required/>

          <label>Full description *</label><textarea id="longDesc" required placeholder="Describe the job in detail‚Ä¶"></textarea>

        </div>

      </div>



      <!-- ÿ≤ÿ± ÿ•ÿ±ÿ≥ÿßŸÑ ÿ´ÿßÿ®ÿ™ -->

      <div class="sticky-footer">

        <button id="sendBtn" class="btn primary">üöÄ Post Job</button>

        <span id="sendMsg" class="hint"></span>

      </div>

    </div>

  </div>



  <!-- Scripts -->

  <script>

    // ŸÅÿ™ÿ≠/ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑŸÖŸàÿØÿßŸÑ + ŸÖŸÜÿπ ÿ™ŸÖÿ±Ÿäÿ± ÿßŸÑÿÆŸÑŸÅŸäÿ©

    const modal = document.getElementById('modal');

    const htmlEl = document.documentElement;

    const openDoor = () => { modal.style.display = 'flex'; htmlEl.style.overflow = 'hidden'; };

    const closeDoor = () => { modal.style.display = 'none'; htmlEl.style.overflow = ''; };



    document.getElementById('postJobTop').onclick = () => {

      openDoor();

      document.querySelector('.sheet').scrollTop = 0;

    };

    document.getElementById('closeDoor').onclick = () => { resetSheet(); closeDoor(); };



    // Check offer prices

    document.getElementById('checkOffers').onclick = () => {

      const id = prompt('Enter your Job ID to check offer prices:');

      if (id) location.href = `/offers.html?id=${encodeURIComponent(id)}`;

    };

    document.getElementById('goQuick').onclick = () => {

      const id = document.getElementById('jobIdQuick').value.trim();

      if (id) location.href = `/offers.html?id=${encodeURIComponent(id)}`;

    };



    // ÿ¥ÿ®ŸÉÿ© ÿßŸÑŸÅÿ¶ÿßÿ™

    const CATS = [

      ['General Home Repairs','üõ†'],['Electrical','‚ö°'],['Plumbing','üö∞'],['Roofing & Gutters','üè†'],

      ['Painting','üé®'],['Flooring','üß±'],['Landscaping','üåø'],['HVAC','‚ùÑÔ∏è'],['Basement','üèöÔ∏è'],

      ['Carpentry','üî®'],['Windows & Doors','üö™'],['Appliances','üîå']

    ];

    const grid = document.getElementById('iconGrid');

    const uploader = document.getElementById('uploaderArea');

    const catTitle = document.getElementById('catTitle');

    const sheetTitle = document.getElementById('sheetTitle');

    const backBtn = document.getElementById('backBtn');

    let selectedCategory = null;



    CATS.forEach(([name, emoji])=>{

      const el = document.createElement('button');

      el.type = 'button';

      el.className = 'icon';

      el.innerHTML = `<div class="emoji">${emoji}</div><span>${name}</span>`;

      el.onclick = () => {

        selectedCategory = name;

        catTitle.textContent = 'Selected: ' + name;

        sheetTitle.textContent = 'Post a Job';

        uploader.classList.remove('hidden');

        uploader.scrollIntoView({behavior:'smooth', block:'start'});

      };

      grid.appendChild(el);

    });



    // ÿ≤ÿ± ÿ±ÿ¨Ÿàÿπ ÿ∞ŸÉŸä

    backBtn.onclick = () => {

      if (!uploader.classList.contains('hidden')) {

        uploader.classList.add('hidden');

        selectedCategory = null;

        catTitle.textContent = '';

        sheetTitle.textContent = 'Choose a category (12)';

        grid.scrollIntoView({behavior:'smooth', block:'start'});

      } else {

        closeDoor();

      }

    };



    // ÿ±ŸÅÿπ ÿßŸÑÿµŸàÿ±

    const fileInput = document.getElementById('fileInput');

    const pickBtn = document.getElementById('pickBtn');

    const fileList = document.getElementById('fileList');

    pickBtn.onclick = () => fileInput.click();

    fileInput.addEventListener('change', ()=>{

      fileList.innerHTML = '';

      [...fileInput.files].forEach(f=>{

        const p = document.createElement('p');

        p.textContent = `${f.name} (${Math.round(f.size/1024)} KB)`;

        fileList.appendChild(p);

      });

    });



    // Helpers Base64

    const bufToBase64 = (buf)=>{

      let bin = ''; new Uint8Array(buf).forEach(b=>bin += String.fromCharCode(b));

      return btoa(bin);

    };

    const filesToBase64 = async (list)=>{

      const arr = [];

      for (const f of [...list||[]]) {

        const buf = await f.arrayBuffer();

        arr.push(bufToBase64(buf));

      }

      return arr;

    };



    // Reset sheet state

    const resetSheet = () => {

      uploader.classList.add('hidden');

      selectedCategory = null;

      catTitle.textContent = '';

      sheetTitle.textContent = 'Choose a category (12)';

      fileInput.value = '';

      fileList.innerHTML = '';

    };



    // ÿ•ÿ±ÿ≥ÿßŸÑ

    document.getElementById('sendBtn').addEventListener('click', async ()=>{

      const m = document.getElementById('sendMsg');

      try{

        if(!selectedCategory){ m.textContent='Choose a category first.'; return; }



        const title = document.getElementById('title').value.trim();

        const summary = document.getElementById('summary').value.trim();

        const city = document.getElementById('city').value.trim();

        const state = document.getElementById('state').value.trim();

        const budget_min = document.getElementById('budgetMin').value || null;

        const budget_max = document.getElementById('budgetMax').value || null;

        const contact_name = document.getElementById('contactName').value.trim();

        const phone = document.getElementById('phone').value.trim();

        const email = document.getElementById('email').value.trim();

        const address = document.getElementById('address').value.trim();

        const description_long = document.getElementById('longDesc').value.trim();



        if(!title||!contact_name||!phone||!email||!address||!description_long){

          m.textContent='Please fill all required fields.'; return;

        }



        m.textContent='Uploading‚Ä¶';

        const photosBase64 = await filesToBase64(fileInput.files);



        const res = await fetch('/api/jobs/create', {

          method:'POST',

          headers:{'Content-Type':'application/json'},

          body:JSON.stringify({

            category:selectedCategory, title, summary, city, state, budget_min, budget_max,

            address, contact_name, phone, email, description_long, photosBase64

          })

        });

        const j = await res.json();

        if(!res.ok || !j.ok) throw new Error(j.error||'Failed');



        m.textContent='Posted ‚úî Job ID: '+j.job_id;

        m.className='hint ok';

        setTimeout(()=>{ m.textContent=''; resetSheet(); closeDoor(); }, 1300);

      }catch(e){

        m.textContent='Error: '+(e.message||'failed');

        m.className='hint err';

      }

    });

  </script>

</body>

</html>
