<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>ProBuildZone — Get Home Projects Done</title>
<meta name="description" content="Post your project with photos. Local contractors send offers. You choose the best match — fair prices, local pros.">
<link rel="stylesheet" href="/style.css"/> <!-- Added leading slash for root-relative path -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>

<body>
<!-- ===== Header / Navbar ===== -->
<header>
<nav>
<div class="brand-logo">
<span class="pro">Pro</span><span class="build">Build</span><span class="zone">Zone</span>
</div>
<ul>
<!-- Services opens modal (about) -->
<li><a href="#about" class="nav-link" id="openAbout">Services</a></li>
<!-- For Pros separate page -->
<li><a href="/pros.html" class="pro-btn">For Pros</a></li> <!-- Added leading slash for root-relative path -->
</ul>
</nav>
</header>

<!-- ===== Hero ===== -->
<section class="hero" id="home">
<div class="overlay">
<h1>Get Home Projects Done — Fair Prices, Local Pros.</h1>
<p>Post your project with photos. Local contractors send offers. You choose the best match.</p>
<div class="buttons">
<button class="btn primary" id="postJobTop">Post a Job (Free)</button>
</div>
<div class="job-id">
<input id="jobIdQuick" type="text" placeholder="Enter Job ID (e.g., PBZ-99999)">
<button id="goQuick">Go</button>
</div>
</div>
</section>

<!-- ===== Footer Links ===== -->
<section id="links" class="links-row">
<a href="#about" class="nav-link" id="openAbout2">Services</a><span>•</span>
<a href="/privacy.html">Privacy</a><span>•</span> <!-- Added leading slash for root-relative path -->
<a href="/terms.html">Terms</a> <!-- Added leading slash for root-relative path -->
</section>

<!-- ===== Services / About modal (hidden) ===== -->
<div class="about-modal" id="aboutModal" style="display:none">
<div class="about-dialog">
<div class="about-head">
<h3>About our platform</h3>
<button class="btn xsm ghost" id="aboutClose">Close</button>
</div>
<div class="about-body">
<p><strong>ProBuildZone</strong> is a matching platform that connects homeowners with local, vetted pros. We are <em>not</em> a contractor, and we don’t perform any manual work or handle payments between parties.</p>
<ul>
<li>🔗 We introduce homeowners to qualified builders/pros.</li>
<li>🔒 Privacy-first — project photos, address, and contact info stay private until the owner approves sharing.</li>
<li>🤝 You negotiate scope, timing, and price directly with the pro.</li>
<li>💳 No platform fees; we never interfere with any offer or payment.</li>
</ul>
</div>
</div>
</div>

<!-- ===== Modal (2-step Post a Job) ===== -->
<div class="modal" id="modal" style="display:none">
<div class="sheet">
<div class="sheet-head">
<button class="btn xsm ghost back" id="backBtn">← Back</button>
<h3 id="sheetTitle">Post a Job</h3>
<button class="btn xsm ghost" id="closeDoor">Close</button>
</div>
<!-- STEP 1: Categories only -->
<section class="job-form" id="step1">
<h2>Choose a category</h2>
<p class="note">Pick what best fits your project. You can change later.</p>
<div class="cat-grid">
<button class="cat-card" data-cat="Roofing">🏠 <span>Roofing</span></button>
<button class="cat-card" data-cat="Decks & Porches">🪚 <span>Decks & Porches</span></button>
<button class="cat-card" data-cat="Kitchens">🍳 <span>Kitchens</span></button>
<button class="cat-card" data-cat="Bathrooms">🛁 <span>Bathrooms</span></button>
<button class="cat-card" data-cat="Flooring">🪵 <span>Flooring</span></button>
<button class="cat-card" data-cat="Painting">🎨 <span>Painting</span></button>
<button class="cat-card" data-cat="Masonry">🧱 <span>Masonry</span></button>
<button class="cat-card" data-cat="Electrical">⚡ <span>Electrical</span></button>
<button class="cat-card" data-cat="Plumbing">🚰 <span>Plumbing</span></button>
<button class="cat-card" data-cat="Windows & Doors">🪟 <span>Windows & Doors</span></button>
<button class="cat-card" data-cat="Landscaping">🌿 <span>Landscaping</span></button>
<button class="cat-card" data-cat="Handyman">🧰 <span>Handyman</span></button>
</div>
</section>
<!-- STEP 2: Full form (with upload on top) -->
<section class="job-form" id="step2" style="display:none">
<!-- selected category badge -->
<div class="selected-cat" id="selectedCat">Category: <b>-</b></div>
<!-- Upload -->
<div class="upload-wrap" id="dropZone">
<input type="file" id="fileInput" multiple accept="image/*,application/pdf"/>
<button type="button" class="btn outline" id="pickBtn">
<i class="fa-solid fa-cloud-arrow-up"></i> Choose Photos/Files
</button>
<span class="hint">You can select multiple photos or a PDF plan. Drag & drop is supported.</span>
</div>
<div class="file-hint">💡 Adding photos helps pros understand your project better (optional)</div>
<div class="card" id="fileList"></div>
<!-- hidden field to send category -->
<input type="hidden" id="categoryHidden" value="General" />
<label for="title">Project title *</label>
<input id="title" type="text" placeholder="e.g., Replace leaking roof" required>
<label for="summary">Short summary</label>
<input id="summary" type="text" placeholder="One or two lines...">
<div class="row2">
<div>
<label for="city">City</label>
<input id="city" type="text" placeholder="Enter your city">
</div>
<div>
<label for="state">State</label>
<input id="state" type="text" placeholder="Enter your state">
</div>
</div>
<label>Estimated budget range</label>
<div class="row2">
<div><input id="budgetMin" type="number" placeholder="From ($)"></div>
<div><input id="budgetMax" type="number" placeholder="To ($)"></div>
</div>
<span class="hint">Just an estimate — pros will confirm after seeing your project.</span>
<div class="row2">
<div>
<label for="contactName">Contact name *</label>
<input id="contactName" type="text" placeholder="Your name" required>
</div>
<div>
<label for="phone">Phone *</label>
<input id="phone" type="tel" placeholder="Your phone number" required>
</div>
</div>
<label for="email">Email *</label>
<input id="email" type="email" placeholder="Your email address" required>
<label for="address">Full address *</label>
<input id="address" type="text" placeholder="Street, City, State" required>
<label for="longDesc">Full description *</label>
<textarea id="longDesc" placeholder="Describe the job in detail..." rows="4" required></textarea>
<div class="center" style="margin-top:10px">
<button id="sendBtn" class="btn primary">🚀 Post Job</button>
<span id="sendMsg" class="hint"></span>
</div>
</section>
</div>
</div>

<!-- ===== JS ===== -->
<script>
// --- Services (About) modal ---
const aboutModal = document.getElementById('aboutModal');
const openAbout = (e)=>{ if(e) e.preventDefault(); aboutModal.style.display='grid'; document.documentElement.style.overflow='hidden'; };
const closeAbout = ()=>{ aboutModal.style.display='none'; document.documentElement.style.overflow=''; };
document.getElementById('openAbout')?.addEventListener('click', openAbout);
document.getElementById('openAbout2')?.addEventListener('click', openAbout);
document.getElementById('aboutClose')?.addEventListener('click', closeAbout);
aboutModal?.addEventListener('click', (ev)=>{ if(ev.target===aboutModal) closeAbout(); });

// --- Modal (Post a Job) 2-step flow ---
const modal = document.getElementById('modal');
const step1 = document.getElementById('step1');
const step2 = document.getElementById('step2');
const sheet = document.querySelector('.sheet');
const selectedCatEl = document.getElementById('selectedCat').querySelector('b');
const hiddenCat = document.getElementById('categoryHidden');

function openDoor(){ modal.style.display='flex'; document.documentElement.style.overflow='hidden'; goStep(1); }
function closeDoor(){ modal.style.display='none'; document.documentElement.style.overflow=''; }

function goStep(n){
if(n===1){ step1.style.display='block'; step2.style.display='none'; document.getElementById('sheetTitle').textContent='Post a Job'; }
if(n===2){ step1.style.display='none'; step2.style.display='block'; document.getElementById('sheetTitle').textContent='Post a Job'; sheet.scrollTop=0; }
}

document.getElementById('postJobTop').addEventListener('click', ()=>{ openDoor(); });
document.getElementById('closeDoor').addEventListener('click', closeDoor);
document.getElementById('backBtn').addEventListener('click', ()=>{
// if already at step1, close; else go back to step1
if(step1.style.display==='block') closeDoor(); else goStep(1);
});

// Category cards → set value & go to step 2
document.querySelectorAll('.cat-card').forEach(btn=>{
btn.addEventListener('click', ()=>{
const val = btn.dataset.cat;
hiddenCat.value = val;
selectedCatEl.textContent = val;
goStep(2);
});
});

// Job ID lookup
document.getElementById('goQuick').addEventListener('click', ()=>{
const id = document.getElementById('jobIdQuick').value.trim();
if(id){ location.href = `/offers.html?id=${encodeURIComponent(id)}`; } // Added leading slash for root-relative path
});

// Upload preview
const fileInput = document.getElementById('fileInput');
const pickBtn = document.getElementById('pickBtn');
const fileList = document.getElementById('fileList');
const dropZone = document.getElementById('dropZone');
if(pickBtn) pickBtn.onclick = ()=> fileInput.click();

const humanSize = (b)=> b<1024? (b+' B') : b<1048576? ((b/1024).toFixed(1)+' KB') : ((b/1048576).toFixed(1)+' MB');
const renderList = (files)=>{
fileList.innerHTML='';
if(!files.length){ fileList.innerHTML='<span class="hint">No files selected yet.</span>'; return; }
[...files].forEach(f=>{
const isImg = /^image\//.test(f.type);
const item = document.createElement('div');
item.className='file-item';
item.innerHTML = `
<div class="thumb">${isImg ? `<img src="${URL.createObjectURL(f)}" alt="">` : `<i class="fa-regular fa-file-lines"></i>`}</div>
<div class="meta"><b>${f.name}</b><span>${f.type || 'file'} • ${humanSize(f.size)}</span></div>
`;
fileList.appendChild(item);
});
};
fileInput?.addEventListener('change', ()=>renderList(fileInput.files));
['dragenter','dragover','dragleave','drop'].forEach(e=>dropZone?.addEventListener(e,ev=>{ev.preventDefault();ev.stopPropagation();},false));
['dragenter','dragover'].forEach(e=>dropZone?.addEventListener(e,()=>dropZone.classList.add('hover'),false));
['dragleave','drop'].forEach(e=>dropZone?.addEventListener(e,()=>dropZone.classList.remove('hover'),false));
dropZone?.addEventListener('drop', ev=>{ const dt=ev.dataTransfer; if(dt?.files){ fileInput.files=dt.files; renderList(fileInput.files); }});

// Base64 helper
const bufToBase64 = (buf)=>{ let bin=''; new Uint8Array(buf).forEach(b=>bin+=String.fromCharCode(b)); return btoa(bin); };
const filesToBase64 = async(list)=>{ const arr=[]; for(const f of [...list||[]]){ if(f.size>10*1024*1024) throw new Error(`File too large: ${f.name}`); const buf=await f.arrayBuffer(); arr.push(bufToBase64(buf)); } return arr; };

// Submit Job
document.getElementById('sendBtn').addEventListener('click', async ()=>{
const m = document.getElementById('sendMsg');
try{
const payload = {
category: hiddenCat.value || 'General',
title: document.getElementById('title').value.trim(),
summary: document.getElementById('summary').value.trim(),
city: document.getElementById('city').value.trim(),
state: document.getElementById('state').value.trim(),
budget_min: document.getElementById('budgetMin').value || null,
budget_max: document.getElementById('budgetMax').value || null,
contact_name: document.getElementById('contactName').value.trim(),
phone: document.getElementById('phone').value.trim(),
email: document.getElementById('email').value.trim(),
address: document.getElementById('address').value.trim(),
description_long: document.getElementById('longDesc').value.trim(),
photosBase64: await filesToBase64(fileInput.files),
// TODO: default_notify_email = "contact@probuildzone.com"
};
if(!payload.category||!payload.title||!payload.contact_name||!payload.phone||!payload.email||!payload.address||!payload.description_long){
m.textContent='Please fill all required fields.'; return;
}
m.textContent='Uploading…';
const res = await fetch('/api/jobs/create', { // Ensure this matches your API route
method:'POST',
headers:{'Content-Type':'application/json'},
body: JSON.stringify(payload)
});
const j = await res.json();
if(!res.ok || !j.ok) throw new Error(j.error || 'Failed');
m.textContent = 'Posted ✔ Job ID: ' + j.job_id;
m.className = 'hint ok';
setTimeout(()=>{ m.textContent=''; closeDoor(); }, 1200);
}catch(e){
m.textContent = 'Error: ' + (e.message || 'failed');
m.className = 'hint err';
}
});
</script>
</body>
</html>
