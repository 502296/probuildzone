<!DOCTYPE html>

<html lang="en">

<head>

  <meta charset="UTF-8" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <title>ProBuildZone — Get Home Projects Done</title>

  <meta name="description" content="Post your project with photos. Local contractors send offers. You choose the best match — fair prices, local pros.">

  <link rel="stylesheet" href="style.css"/>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

</head>



<body>

  <!-- ===== Header / Navbar ===== -->

  <header>

    <nav>

      <div class="brand-logo">

        <span class="pro">Pro</span><span class="build">Build</span><span class="zone">Zone</span>

      </div>

      <ul>

        <!-- Services now explains the platform -->

        <li><a href="#about" class="nav-link">Services</a></li>

        <!-- For Pros goes to its own page -->

        <li><a href="pros.html" class="pro-btn">For Pros</a></li>

      </ul>

    </nav>

  </header>



  <!-- ===== Hero ===== -->

  <section class="hero" id="home">

    <div class="overlay">

      <h1>Get Home Projects Done — Fair Prices, Local Pros.</h1>

      <p>Post your project with photos. Local contractors send offers. You choose the best match.</p>



      <div class="buttons">

        <!-- Ensure this always opens the modal -->

        <button class="btn primary" id="postJobTop" onclick="openDoor()">Post a Job (Free)</button>

        <!-- keep only Job ID controls (no extra hero buttons) -->

      </div>



      <div class="job-id">

        <input id="jobIdQuick" type="text" placeholder="Enter Job ID (e.g., PBZ-99999)">

        <button id="goQuick">Go</button>

      </div>

    </div>

  </section>



  <!-- ===== About the Platform (Services explanation) ===== -->

  <section id="about" class="about">

    <div class="box">

      <h2>About our platform</h2>

      <p><strong>ProBuildZone</strong> is a matching platform that connects homeowners with local, vetted pros. We are <em>not</em> a contractor, and we don’t perform any manual work or handle payments between parties.</p>

      <ul>

        <li>🔗 We introduce homeowners to qualified builders/pros.</li>

        <li>🔒 Privacy-first — project photos, address, and contact info stay private until the owner approves sharing.</li>

        <li>🤝 You negotiate scope, timing, and price directly with the pro.</li>

        <li>💳 No platform fees; we never interfere with any offer or payment.</li>

      </ul>

    </div>

  </section>



  <!-- ===== Footer Links (unchanged) ===== -->

  <section id="links" class="links-row">

    <a href="#about" class="nav-link">Services</a><span>•</span>

    <a href="privacy.html">Privacy</a><span>•</span>

    <a href="terms.html">Terms</a>

  </section>



  <!-- ===== Modal (Form) ===== -->

  <div class="modal" id="modal" style="display:none">

    <div class="sheet">

      <div class="sheet-head">

        <button class="btn xsm ghost back" id="backBtn">← Back</button>

        <h3 id="sheetTitle">Post a Job</h3>

        <button class="btn xsm ghost" id="closeDoor">Close</button>

      </div>



      <section class="job-form">

        <h2>Owner details & project info</h2>

        <p class="note">Private fields are hidden from pros until you approve them.</p>



        <!-- Upload -->

        <div class="upload-wrap" id="dropZone">

          <input type="file" id="fileInput" multiple accept="image/*,application/pdf"/>

          <button type="button" class="btn outline" id="pickBtn">

            <i class="fa-solid fa-cloud-arrow-up"></i> Choose Photos/Files

          </button>

          <span class="hint">You can select multiple photos or a PDF plan. Drag & drop is supported.</span>

        </div>

        <div class="file-hint">💡 Adding photos helps pros understand your project better (optional)</div>

        <div class="card" id="fileList"></div>



        <!-- Category (12 icons) -->

        <label>Category *</label>

        <div class="form-categories">

          <label><input type="radio" name="category" value="Roofing" required> 🏠 Roofing</label>

          <label><input type="radio" name="category" value="Decks & Porches"> 🪚 Decks & Porches</label>

          <label><input type="radio" name="category" value="Kitchens"> 🍳 Kitchens</label>

          <label><input type="radio" name="category" value="Bathrooms"> 🛁 Bathrooms</label>

          <label><input type="radio" name="category" value="Flooring"> 🪵 Flooring</label>

          <label><input type="radio" name="category" value="Painting"> 🎨 Painting</label>

          <label><input type="radio" name="category" value="Masonry"> 🧱 Masonry</label>

          <label><input type="radio" name="category" value="Electrical"> ⚡ Electrical</label>

          <label><input type="radio" name="category" value="Plumbing"> 🚰 Plumbing</label>

          <label><input type="radio" name="category" value="Windows & Doors"> 🪟 Windows & Doors</label>

          <label><input type="radio" name="category" value="Landscaping"> 🌿 Landscaping</label>

          <label><input type="radio" name="category" value="Handyman"> 🧰 Handyman</label>

        </div>



        <label for="title">Project title *</label>

        <input id="title" type="text" placeholder="e.g., Replace leaking roof" required>



        <label for="summary">Short summary</label>

        <input id="summary" type="text" placeholder="One or two lines...">



        <div class="row2">

          <div>

            <label for="city">City</label>

            <input id="city" type="text" placeholder="Enter your city">

          </div>

          <div>

            <label for="state">State</label>

            <input id="state" type="text" placeholder="Enter your state">

          </div>

        </div>



        <label>Estimated budget range</label>

        <div class="row2">

          <div><input id="budgetMin" type="number" placeholder="From ($)"></div>

          <div><input id="budgetMax" type="number" placeholder="To ($)"></div>

        </div>

        <span class="hint">Just an estimate — pros will confirm after seeing your project.</span>



        <div class="row2">

          <div>

            <label for="contactName">Contact name *</label>

            <input id="contactName" type="text" placeholder="Your name" required>

          </div>

          <div>

            <label for="phone">Phone *</label>

            <input id="phone" type="tel" placeholder="Your phone number" required>

          </div>

        </div>



        <label for="email">Email *</label>

        <input id="email" type="email" placeholder="Your email address" required>



        <label for="address">Full address *</label>

        <input id="address" type="text" placeholder="Street, City, State" required>



        <label for="longDesc">Full description *</label>

        <textarea id="longDesc" placeholder="Describe the job in detail..." rows="4" required></textarea>

      </section>

    </div>



    <!-- Fixed Action -->

    <div class="action-bar" id="actionBar">

      <div class="bar-inner">

        <button id="sendBtn" class="btn primary">🚀 Post Job</button>

        <span id="sendMsg" class="hint"></span>

      </div>

    </div>

  </div>



  <!-- ===== JS ===== -->

  <script>

    // Smooth scroll for internal links

    document.querySelectorAll('.nav-link').forEach(a=>{

      a.addEventListener('click', (e)=>{

        const href = a.getAttribute('href');

        if(href && href.startsWith('#')){

          e.preventDefault();

          document.querySelector(href)?.scrollIntoView({behavior:'smooth'});

        }

      });

    });



    // Modal controls (robust)

    const modal = document.getElementById('modal');

    function openDoor(){ modal.style.display='flex'; document.documentElement.style.overflow='hidden'; }

    function closeDoor(){ modal.style.display='none'; document.documentElement.style.overflow=''; }



    const sheet = document.querySelector('.sheet');

    document.getElementById('postJobTop').addEventListener('click', ()=>{ openDoor(); sheet.scrollTop=0; });

    document.getElementById('closeDoor').addEventListener('click', closeDoor);

    document.getElementById('backBtn').addEventListener('click', closeDoor);



    // Job ID lookup

    document.getElementById('goQuick').addEventListener('click', ()=>{

      const id = document.getElementById('jobIdQuick').value.trim();

      if(id){ location.href = `/offers.html?id=${encodeURIComponent(id)}`; }

    });



    // Upload preview

    const fileInput = document.getElementById('fileInput');

    const pickBtn = document.getElementById('pickBtn');

    const fileList = document.getElementById('fileList');

    const dropZone = document.getElementById('dropZone');

    pickBtn.onclick = ()=> fileInput.click();



    const humanSize = (b)=> b<1024? (b+' B') : b<1048576? ((b/1024).toFixed(1)+' KB') : ((b/1048576).toFixed(1)+' MB');

    const renderList = (files)=>{

      fileList.innerHTML='';

      if(!files.length){ fileList.innerHTML='<span class="hint">No files selected yet.</span>'; return; }

      [...files].forEach(f=>{

        const isImg = /^image\//.test(f.type);

        const item = document.createElement('div');

        item.className='file-item';

        item.innerHTML = `

          <div class="thumb">${isImg ? `<img src="${URL.createObjectURL(f)}" alt="">` : `<i class="fa-regular fa-file-lines"></i>`}</div>

          <div class="meta"><b>${f.name}</b><span>${f.type || 'file'} • ${humanSize(f.size)}</span></div>

        `;

        fileList.appendChild(item);

      });

    };

    fileInput.addEventListener('change', ()=>renderList(fileInput.files));

    ['dragenter','dragover','dragleave','drop'].forEach(e=>dropZone.addEventListener(e,ev=>{ev.preventDefault();ev.stopPropagation();},false));

    ['dragenter','dragover'].forEach(e=>dropZone.addEventListener(e,()=>dropZone.classList.add('hover'),false));

    ['dragleave','drop'].forEach(e=>dropZone.addEventListener(e,()=>dropZone.classList.remove('hover'),false));

    dropZone.addEventListener('drop', ev=>{ const dt=ev.dataTransfer; if(dt?.files){ fileInput.files=dt.files; renderList(fileInput.files); }});



    // Convert files to base64

    const bufToBase64 = (buf)=>{ let bin=''; new Uint8Array(buf).forEach(b=>bin+=String.fromCharCode(b)); return btoa(bin); };

    const filesToBase64 = async(list)=>{ const arr=[]; for(const f of [...list||[]]){ if(f.size>10*1024*1024) throw new Error(`File too large: ${f.name}`); const buf=await f.arrayBuffer(); arr.push(bufToBase64(buf)); } return arr; };



    // Submit Job  (API endpoint placeholder)

    document.getElementById('sendBtn').addEventListener('click', async ()=>{

      const m = document.getElementById('sendMsg');

      try{

        const catEl = document.querySelector('input[name="category"]:checked');

        const category = catEl ? catEl.value : null;



        const payload = {

          category,

          title: document.getElementById('title').value.trim(),

          summary: document.getElementById('summary').value.trim(),

          city: document.getElementById('city').value.trim(),

          state: document.getElementById('state').value.trim(),

          budget_min: document.getElementById('budgetMin').value || null,

          budget_max: document.getElementById('budgetMax').value || null,

          contact_name: document.getElementById('contactName').value.trim(),

          phone: document.getElementById('phone').value.trim(),

          email: document.getElementById('email').value.trim(),

          address: document.getElementById('address').value.trim(),

          description_long: document.getElementById('longDesc').value.trim(),

          photosBase64: await filesToBase64(fileInput.files),

          // TODO: default_notify_email = "contact@probuildzone.com"  (ضع بريد الإشعارات هنا لو رغبت)

        };



        if(!payload.category||!payload.title||!payload.contact_name||!payload.phone||!payload.email||!payload.address||!payload.description_long){

          m.textContent='Please fill all required fields.'; return;

        }



        m.textContent='Uploading…';

        const res = await fetch('/api/jobs/create', {

          method:'POST',

          headers:{'Content-Type':'application/json'},

          body: JSON.stringify(payload)

        });

        const j = await res.json();

        if(!res.ok || !j.ok) throw new Error(j.error || 'Failed');



        m.textContent = 'Posted ✔ Job ID: ' + j.job_id;

        m.className = 'hint ok';

        setTimeout(()=>{ m.textContent=''; closeDoor(); }, 1200);

      }catch(e){

        m.textContent = 'Error: ' + (e.message || 'failed');

        m.className = 'hint err';

      }

    });

  </script>

</body>

</html>
