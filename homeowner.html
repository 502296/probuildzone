<!doctype html>

<html lang="en">

<head>

  <meta charset="utf-8" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Post a Job ‚Äì Probuildzone</title>

  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <style>

    body{

      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;

      background:#0F2A43;

      margin:0;

      min-height:100vh;

      display:flex;

      justify-content:center;

      align-items:flex-start;

      padding:30px 12px 50px;

      color:#fff;

    }

    .card{

      background:#fff;

      color:#000;

      border-radius:18px;

      max-width:720px;

      width:100%;

      padding:20px 18px 26px;

      box-shadow:0 20px 55px rgba(0,0,0,.15);

    }

    h1{margin-top:0;margin-bottom:16px;font-size:22px}

    label{display:block;font-weight:600;margin-bottom:6px}

    input,select,textarea{

      width:100%;

      border:1px solid #d5d9de;

      border-radius:10px;

      padding:10px 11px;

      font:inherit;

      background:#fff;

    }

    textarea{min-height:110px;resize:vertical}

    .row{

      display:grid;

      grid-template-columns:repeat(auto-fit,minmax(150px,1fr));

      gap:12px;

    }

    .mt{margin-top:14px}

    .btn{

      display:inline-block;

      border:none;

      background:#00A8FF;

      color:#fff;

      font-weight:600;

      padding:12px 18px;

      border-radius:14px;

      cursor:pointer;

      width:100%;

      text-align:center;

    }

    .alert{

      margin-top:12px;

      background:#fdeeee;

      border:1px solid #f4c3c3;

      border-radius:10px;

      padding:10px 12px;

      color:#a52f2f;

      display:none;

      white-space:pre-wrap;

    }

    .success{

      margin-top:12px;

      background:#ecfdf3;

      border:1px solid #c5f1d5;

      border-radius:10px;

      padding:10px 12px;

      color:#167a3a;

      display:none;

      white-space:pre-wrap;

    }

    @media (max-width:520px){

      .card{padding:16px 14px 24px}

    }

  </style>

</head>

<body>

  <div class="card">

    <h1>Post a Job</h1>

    <!-- ŸÜŸÖŸàÿ∞ÿ¨ homeowner -->

    <div class="mt">

      <label for="hoCategory">Category</label>

      <select id="hoCategory">

        <option value="Roofing">Roofing</option>

        <option value="Decks & Porches">Decks &amp; Porches</option>

        <option value="Kitchens">Kitchens</option>

        <option value="Bathrooms">Bathrooms</option>

        <option value="Flooring">Flooring</option>

        <option value="Painting">Painting</option>

        <option value="Masonry">Masonry</option>

        <option value="Electrical">Electrical</option>

        <option value="Plumbing">Plumbing</option>

        <option value="Windows & Doors">Windows &amp; Doors</option>

        <option value="Landscaping" selected>Landscaping</option>

        <option value="Handyman">Handyman</option>

      </select>

    </div>



    <div class="mt">

      <label for="hoPhotos">Photos / Files (optional)</label>

      <input id="hoPhotos" type="file" multiple />

      <small>You can upload one or more photos</small>

    </div>



    <div class="mt">

      <label for="hoTitle">Project title *</label>

      <input id="hoTitle" placeholder="e.g., Replace leaking roof" required>

    </div>



    <div class="mt">

      <label for="hoSummary">Short summary</label>

      <input id="hoSummary" placeholder="One or two lines...">

    </div>



    <div class="row mt">

      <div>

        <label for="hoCity">City</label>

        <input id="hoCity" placeholder="Enter your city">

      </div>

      <div>

        <label for="hoState">State</label>

        <input id="hoState" placeholder="Enter your state">

      </div>

      <div>

        <label for="hoZip">ZIP code</label>

        <input id="hoZip" placeholder="40202">

      </div>

    </div>



    <div class="row mt">

      <div>

        <label for="hoBudgetFrom">Budget From ($)</label>

        <input id="hoBudgetFrom" type="number" min="0" placeholder="100">

      </div>

      <div>

        <label for="hoBudgetTo">Budget To ($)</label>

        <input id="hoBudgetTo" type="number" min="0" placeholder="300">

      </div>

    </div>



    <div class="row mt">

      <div>

        <label for="hoContactName">Contact name *</label>

        <input id="hoContactName" placeholder="Your name">

      </div>

      <div>

        <label for="hoPhone">Phone *</label>

        <input id="hoPhone" placeholder="Your phone number">

      </div>

    </div>



    <div class="mt">

      <label for="hoEmail">Email *</label>

      <input id="hoEmail" type="email" placeholder="you@example.com">

    </div>



    <div class="mt">

      <label for="hoFullAddress">Full address</label>

      <input id="hoFullAddress" placeholder="Street, City, State">

    </div>



    <div class="mt">

      <label for="hoDescription">Full description‚Ä¶</label>

      <textarea id="hoDescription" placeholder="Describe the job in detail..."></textarea>

    </div>



    <div id="hoAlert" class="alert"></div>

    <div id="hoSuccess" class="success"></div>



    <div class="mt">

      <button id="hoPostBtn" class="btn" type="button">üöÄ Post Job</button>

    </div>

  </div>



  <!-- Supabase CDN -->

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>

  <script>

    // üîê ÿ∫ŸäŸëÿ± Ÿáÿ∞ŸàŸÑ ÿ≠ÿ≥ÿ® ŸÖÿ¥ÿ±ŸàÿπŸÉ

    const SUPABASE_URL = 'https://hczahffwghbddqabpbmu.supabase.co';

    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhjemFoZmZ3Z2hiZGRxYWJwYm11Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIzNDc1ODIsImV4cCI6MjA3NzkyMzU4Mn0.rpPNAFSKYhDRu8FTVRX2HZFHmyfpOgqflaKf3LrxPoU';



    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);



    const alertBox = document.getElementById('hoAlert');

    const successBox = document.getElementById('hoSuccess');

    const btn = document.getElementById('hoPostBtn');



    function showError(msg) {

      alertBox.textContent = msg;

      alertBox.style.display = 'block';

      successBox.style.display = 'none';

    }

    function showSuccess(msg) {

      successBox.textContent = msg;

      successBox.style.display = 'block';

      alertBox.style.display = 'none';

    }



    // ÿ±ŸÅÿπ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸÑŸÅÿßÿ™ ÿßŸÑŸÖÿÆÿ™ÿßÿ±ÿ© Ÿàÿ•ÿ±ÿ¨ÿßÿπ ÿßŸÑŸÖÿ≥ÿßÿ±ÿßÿ™

    async function uploadFiles(files) {

      const bucket = 'homeowner_uploads';

      const paths = [];



      for (const file of files) {

        const ext = file.name.split('.').pop();

        const fileName = `job-${Date.now()}-${Math.random().toString(36).slice(2)}.${ext}`;



        const { data, error } = await supabase

          .storage

          .from(bucket)

          .upload(fileName, file);



        if (error) {

          console.warn('upload error', error.message);

          // ŸÜŸÉŸÖŸÑ ÿ≠ÿ™Ÿâ ŸÑŸà ŸÅÿ¥ŸÑ Ÿàÿßÿ≠ÿØ

        } else {

          // ŸÜÿ¨Ÿäÿ® ÿßŸÑÿ±ÿßÿ®ÿ∑ ÿßŸÑÿπÿßŸÖ

          const { data: publicData } = supabase

            .storage

            .from(bucket)

            .getPublicUrl(fileName);



          if (publicData && publicData.publicUrl) {

            paths.push(publicData.publicUrl);

          }

        }

      }



      return paths;

    }



    btn.addEventListener('click', async () => {

      alertBox.style.display = 'none';

      successBox.style.display = 'none';



      // ÿ¨ŸÖÿπ ÿßŸÑŸÇŸäŸÖ

      const payload = {

        category: document.getElementById('hoCategory').value.trim(),

        title: document.getElementById('hoTitle').value.trim(),

        summary: document.getElementById('hoSummary').value.trim(),

        city: document.getElementById('hoCity').value.trim(),

        state: document.getElementById('hoState').value.trim(),

        zip: document.getElementById('hoZip').value.trim(),

        budget_from: document.getElementById('hoBudgetFrom').value.trim(),

        budget_to: document.getElementById('hoBudgetTo').value.trim(),

        contact_name: document.getElementById('hoContactName').value.trim(),

        phone: document.getElementById('hoPhone').value.trim(),

        email: document.getElementById('hoEmail').value.trim(),

        full_address: document.getElementById('hoFullAddress').value.trim(),

        description: document.getElementById('hoDescription').value.trim(),

      };



      // validation ÿ®ÿ≥Ÿäÿ∑

      if (!payload.title || !payload.contact_name || !payload.phone || !payload.email) {

        showError('Please fill title, contact name, phone, and email.');

        return;

      }



      btn.disabled = true;

      btn.textContent = 'Posting...';



      try {

        // 1) ŸÑŸà ŸÅŸä ÿµŸàÿ± ÿßÿ±ŸÅÿπŸáÿß

        const filesInput = document.getElementById('hoPhotos');

        let photos = [];

        if (filesInput.files && filesInput.files.length > 0) {

          photos = await uploadFiles(filesInput.files);

        }



        // 2) ÿÆÿ≤ŸëŸÜ ÿßŸÑÿ∑ŸÑÿ®

        const { data, error } = await supabase

          .from('homeowner_jobs')

          .insert([{

            category: payload.category,

            title: payload.title,

            summary: payload.summary,

            city: payload.city,

            state: payload.state,

            zip: payload.zip,

            budget_from: payload.budget_from,

            budget_to: payload.budget_to,

            contact_name: payload.contact_name,

            phone: payload.phone,

            email: payload.email,

            full_address: payload.full_address,

            description: payload.description,

            photo_urls: photos.length ? photos : null

          }])

          .select()

          .single();



        if (error) {

          console.error(error);

          showError('DB error: ' + error.message);

        } else {

          showSuccess('Job posted successfully!');

          // ŸÖŸÖŸÉŸÜ ÿ™ŸÅÿ±Ÿëÿ∫ ÿßŸÑÿ≠ŸÇŸàŸÑ ŸáŸÜÿß ŸÑŸà ÿ™ÿ®Ÿä

          // document.getElementById('hoTitle').value = '';

        }



      } catch (err) {

        console.error(err);

        showError('Unexpected error: ' + err.message);

      } finally {

        btn.disabled = false;

        btn.textContent = 'üöÄ Post Job';

      }

    });

  </script>

</body>

</html>
