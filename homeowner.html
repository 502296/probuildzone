<!DOCTYPE html>

<html lang="en">

<head>

  <meta charset="UTF-8" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <title>ProBuildZone ‚Äî Homeowner</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <style>

    :root { --brand:#0f2a43; --bg:#f6f7fb; --card:#fff; --ok:#0a7f4f; --err:#b00020; }

    * { box-sizing: border-box; }

    body { font-family:"Inter",system-ui,-apple-system,Segoe UI,sans-serif; background:var(--bg); color:var(--brand); margin:0; padding:40px; }

    h1 { text-align:center; margin:0 0 20px; }

    .card { max-width:560px; margin:24px auto; background:var(--card); padding:24px; border-radius:12px; box-shadow:0 6px 20px rgba(0,0,0,.08); }

    label { display:block; font-weight:600; font-size:.92rem; margin:12px 0 6px; }

    input, textarea, select { width:100%; padding:12px; border:1px solid #d7dde6; border-radius:8px; font-size:1rem; background:#fff; }

    textarea { resize:vertical; min-height:120px; }

    .row { display:flex; gap:12px; }

    .row > div { flex:1; }

    button { width:100%; margin-top:16px; padding:14px 16px; border:0; border-radius:10px; background:#0b7ef4; color:#fff; font-weight:700; cursor:pointer; transition:.2s; }

    button:hover { filter:brightness(.95); }

    button[disabled]{ opacity:.6; cursor:not-allowed; }

    .msg { margin-top:12px; text-align:center; }

    .msg.ok { color:var(--ok); font-weight:600; }

    .msg.err{ color:var(--err); font-weight:600; }

    small.muted{ color:#6b7a8c; display:block; margin-top:4px; }

  </style>

</head>

<body>

  <h1>üè° Post Your Project</h1>



  <div class="card">

    <form id="job-form" novalidate>

      <label for="category">Category (optional)</label>

      <select id="category">

        <option value="General" selected>General</option>

        <option>Roofing</option><option>Decks & Porches</option><option>Kitchens</option>

        <option>Bathrooms</option><option>Flooring</option><option>Painting</option>

        <option>Masonry</option><option>Electrical</option><option>Plumbing</option>

        <option>Windows & Doors</option><option>Landscaping</option><option>Handyman</option>

      </select>



      <label for="title">Project title (optional)</label>

      <input id="title" type="text" placeholder="e.g., Repair porch roof">



      <label for="summary">Short summary (optional)</label>

      <input id="summary" type="text" placeholder="One-line summary">



      <div class="row">

        <div>

          <label for="city">City (optional)</label>

          <input id="city" type="text" placeholder="City">

        </div>

        <div>

          <label for="state">State (optional)</label>

          <input id="state" type="text" placeholder="KY">

        </div>

      </div>



      <label for="name">Full name *</label>

      <input id="name" type="text" required placeholder="Your full name">



      <div class="row">

        <div>

          <label for="email">Email *</label>

          <input id="email" type="email" required placeholder="name@example.com">

        </div>

        <div>

          <label for="phone">Phone *</label>

          <input id="phone" type="tel" required placeholder="(555) 555-5555">

        </div>

      </div>



      <label for="address">Full address *</label>

      <input id="address" type="text" required placeholder="Street, City, State, ZIP">



      <label for="description">Full description *</label>

      <textarea id="description" required placeholder="Describe your project, measurements, timeline, etc."></textarea>



      <small class="muted">Fields marked * are required.</small>



      <button id="postBtn" type="submit">üöÄ Post Job</button>

      <div id="status" class="msg" aria-live="polite"></div>

    </form>

  </div>



  <script>

    const form = document.getElementById('job-form');

    const btn  = document.getElementById('postBtn');

    const statusEl = document.getElementById('status');



    function setStatus(text, type){ statusEl.textContent = text || ''; statusEl.className = 'msg ' + (type || ''); }



    form.addEventListener('submit', async (e) => {

      e.preventDefault(); setStatus('', '');



      const payload = {

        category:    document.getElementById('category').value || 'General',

        title:       document.getElementById('title').value.trim() || null,

        summary:     document.getElementById('summary').value.trim() || null,

        city:        document.getElementById('city').value.trim() || null,

        state:       document.getElementById('state').value.trim() || null,

        name:        document.getElementById('name').value.trim(),

        email:       document.getElementById('email').value.trim(),

        phone:       document.getElementById('phone').value.trim(),

        address:     document.getElementById('address').value.trim(),

        description: document.getElementById('description').value.trim()

      };



      if(!payload.name || !payload.email || !payload.phone || !payload.address || !payload.description){

        return setStatus('Please fill all required fields.', 'err');

      }



      btn.disabled = true; btn.textContent = 'Saving to database‚Ä¶'; setStatus('', '');



      try{

        const res = await fetch('/.netlify/functions/post-job', {

          method:'POST',

          headers:{ 'Content-Type':'application/json', 'Accept':'application/json' },

          body: JSON.stringify(payload)

        });



        const text = await res.text();

        let data; try{ data = JSON.parse(text); } catch { throw new Error(`Non-JSON response (${res.status}): ${text.slice(0,120)}‚Ä¶`); }



        if(!res.ok || !data.ok){ throw new Error(data.error || `Failed with ${res.status}`); }



        setStatus(`‚úÖ Job posted successfully! Your Job ID: ${data.job_id}`, 'ok');

        form.reset();

      }catch(err){

        console.error(err);

        setStatus(`Error: ${err.message}`, 'err');

      }finally{

        btn.disabled = false; btn.textContent = 'üöÄ Post Job';

      }

    });

  </script>

</body>

</html>
