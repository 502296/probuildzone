<!doctype html>

<html lang="en">

<head>

  <meta charset="utf-8" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Post a Job ‚Äî ProBuildZone</title>

  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

  <style>

    :root {

      --pbz: #0F2A43;

      --gold: #D4AF37;

      --muted: #64748b;

      --bg: #f3f5f7;

    }

    * { box-sizing: border-box; }

    body {

      margin: 0;

      background: var(--bg);

      font-family: Inter, system-ui, -apple-system, Segoe UI, sans-serif;

      color: #0f172a;

      min-height: 100vh;

      display: flex;

      align-items: center;

      justify-content: center;

      padding: 26px 14px 40px;

    }

    .card {

      width: min(920px, 100%);

      background: #fff;

      border: 1px solid #e2e8f0;

      border-radius: 18px;

      box-shadow: 0 16px 35px rgba(15, 42, 67, 0.04);

      padding: 20px 20px 24px;

    }

    h1 {

      margin: 0 0 8px;

      font-size: 24px;

      color: var(--pbz);

    }

    .subtitle {

      color: var(--muted);

      margin-bottom: 18px;

      font-size: 14px;

    }

    label {

      display: block;

      font-weight: 500;

      margin-bottom: 6px;

    }

    input, select, textarea {

      width: 100%;

      border: 1px solid #d0d7e2;

      border-radius: 10px;

      padding: 10px 11px;

      font: inherit;

      background: #fff;

    }

    input:focus, select:focus, textarea:focus {

      outline: none;

      border-color: #0b70ff;

      box-shadow: 0 0 0 3px rgba(11, 112, 255, 0.09);

    }

    textarea { min-height: 95px; resize: vertical; }



    .grid {

      display: grid;

      grid-template-columns: repeat(auto-fit, minmax(210px, 1fr));

      gap: 14px 16px;

    }



    .full { grid-column: 1 / -1; }



    .upload-box {

      border: 1px dashed #cbd5e1;

      border-radius: 10px;

      padding: 12px 14px;

      background: #f8fafc;

    }

    .upload-box small { color: #94a3b8; }



    .actions {

      margin-top: 20px;

      display: flex;

      gap: 12px;

      flex-wrap: wrap;

    }

    button {

      border: none;

      cursor: pointer;

      font-weight: 600;

    }

    .btn-main {

      background: var(--gold);

      color: #000;

      padding: 11px 18px;

      border-radius: 10px;

    }

    .btn-sec {

      background: #e2e8f0;

      color: #0f172a;

      padding: 11px 18px;

      border-radius: 10px;

    }

    .alert {

      margin-top: 14px;

      background: #fee2e2;

      border: 1px solid #fecaca;

      border-radius: 10px;

      padding: 8px 12px;

      color: #b91c1c;

      display: none;

      white-space: pre-wrap;

    }

    .success {

      margin-top: 14px;

      background: #ecfdf3;

      border: 1px solid #bbf7d0;

      border-radius: 10px;

      padding: 8px 12px;

      color: #166534;

      display: none;

    }

    @media (max-width: 600px) {

      body { padding: 18px 10px 30px; }

      .card { padding: 16px 14px 20px; }

      .actions { flex-direction: column; }

      .btn-main, .btn-sec { width: 100%; text-align: center; }

    }

  </style>

  <!-- Supabase CDN -->

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>

</head>

<body>

  <div class="card">

    <h1>Post a Job</h1>

    <p class="subtitle">Fill in your project details so contractors can review it.</p>



    <form id="hoForm" novalidate>

      <div class="upload-box full" style="margin-bottom:14px;">

        <label for="hoPhotos">Project photos / files (optional)</label>

        <input id="hoPhotos" type="file" multiple />

        <small>You can add photos or a PDF plan. Max size per file = 50MB.</small>

      </div>



      <div class="grid">

        <div class="full">

          <label for="hoCategory">Category</label>

          <select id="hoCategory">

            <option value="Roofing">Roofing</option>

            <option value="Decks & Porches">Decks &amp; Porches</option>

            <option value="Kitchens">Kitchens</option>

            <option value="Bathrooms">Bathrooms</option>

            <option value="Flooring">Flooring</option>

            <option value="Painting">Painting</option>

            <option value="Masonry">Masonry</option>

            <option value="Electrical">Electrical</option>

            <option value="Plumbing">Plumbing</option>

            <option value="Windows & Doors">Windows &amp; Doors</option>

            <option value="Landscaping">Landscaping</option>

            <option value="Handyman">Handyman</option>

          </select>

        </div>



        <div class="full">

          <label for="hoTitle">Project title *</label>

          <input id="hoTitle" placeholder="Replace leaking roof" required>

        </div>



        <div class="full">

          <label for="hoSummary">Short summary</label>

          <input id="hoSummary" placeholder="One or two lines...">

        </div>



        <div>

          <label for="hoCity">City</label>

          <input id="hoCity" placeholder="Enter your city">

        </div>

        <div>

          <label for="hoState">State</label>

          <input id="hoState" placeholder="Enter your state">

        </div>



        <div>

          <label for="hoBudgetFrom">Budget From ($)</label>

          <input id="hoBudgetFrom" type="number" min="0" placeholder="e.g. 500">

        </div>

        <div>

          <label for="hoBudgetTo">Budget To ($)</label>

          <input id="hoBudgetTo" type="number" min="0" placeholder="e.g. 1500">

        </div>



        <div>

          <label for="hoContactName">Contact name *</label>

          <input id="hoContactName" placeholder="Your name" required>

        </div>

        <div>

          <label for="hoPhone">Phone *</label>

          <input id="hoPhone" placeholder="Your phone number" required>

        </div>

        <div>

          <label for="hoEmail">Email *</label>

          <input id="hoEmail" type="email" placeholder="you@example.com" required>

        </div>

        <div class="full">

          <label for="hoFullAddress">Full address *</label>

          <input id="hoFullAddress" placeholder="Street, City, State" required>

        </div>

        <div class="full">

          <label for="hoDescription">Full description *</label>

          <textarea id="hoDescription" placeholder="Describe the job in detail..." required></textarea>

        </div>

      </div>



      <div id="hoAlert" class="alert"></div>

      <div id="hoSuccess" class="success">Job posted successfully!</div>



      <div class="actions">

        <button type="reset" class="btn-sec">Reset</button>

        <button id="hoPostBtn" type="button" class="btn-main">üöÄ Post Job</button>

      </div>

    </form>

  </div>



  <script>

    // 1) ÿπÿØŸëŸÑ Ÿáÿ∞ŸàŸÑ ÿ®ÿßŸÑŸÇŸäŸÖ ÿßŸÑÿµÿ≠Ÿäÿ≠ÿ© ŸÖŸÜ ŸÖÿ¥ÿ±ŸàÿπŸÉ

    const SUPABASE_URL = 'https://hczahffwghbddqabpbmu.supabase.co';

    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhjemFoZmZ3Z2hiZGRxYWJwYm11Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIzNDc1ODIsImV4cCI6MjA3NzkyMzU4Mn0.rpPNAFSKYhDRu8FTVRX2HZFHmyfpOgqflaKf3LrxPoU';



    // 2) ÿ•ŸÜÿ¥ÿßÿ° ÿπŸÖŸäŸÑ Supabase

    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);



    const alertBox = document.getElementById('hoAlert');

    const successBox = document.getElementById('hoSuccess');

    const btn = document.getElementById('hoPostBtn');



    function showError(msg) {

      alertBox.textContent = msg;

      alertBox.style.display = 'block';

      successBox.style.display = 'none';

    }

    function showSuccess(msg) {

      successBox.textContent = msg;

      successBox.style.display = 'block';

      alertBox.style.display = 'none';

    }

    function clearMsg() {

      alertBox.style.display = 'none';

      successBox.style.display = 'none';

    }



    // ÿ±ŸÅÿπ ŸÖÿ¨ŸÖŸàÿπÿ© ŸÖŸÑŸÅÿßÿ™

    async function uploadFiles(files) {

      const bucket = 'homeowner_uploads';

      const uploaded = [];



      for (const file of files) {

        const fileName = `job-${Date.now()}-${Math.random().toString(36).slice(2)}-${file.name}`;

        const { data, error } = await supabase

          .storage

          .from(bucket)

          .upload(fileName, file);



        if (error) {

          console.warn('upload error', error.message);

          // ŸÜŸÉŸÖŸëŸÑ ÿ≠ÿ™Ÿâ ŸÑŸà Ÿàÿ≠ÿØÿ© ŸÅÿ¥ŸÑÿ™

        } else {

          uploaded.push(fileName);

        }

      }

      return uploaded;

    }



    async function postJob() {

      clearMsg();



      const title = document.getElementById('hoTitle').value.trim();

      const contact = document.getElementById('hoContactName').value.trim();

      const phone = document.getElementById('hoPhone').value.trim();

      const email = document.getElementById('hoEmail').value.trim();

      const addr = document.getElementById('hoFullAddress').value.trim();

      const desc = document.getElementById('hoDescription').value.trim();



      if (!title || !contact || !phone || !email || !addr || !desc) {

        showError('Please fill all required fields (*)');

        return;

      }



      btn.disabled = true;

      btn.textContent = 'Posting...';



      // 1) ÿßÿ±ŸÅÿπ ÿßŸÑÿµŸàÿ± ÿ£ŸàŸÑ

      const fileInput = document.getElementById('hoPhotos');

      const uploadedPaths = fileInput.files.length

        ? await uploadFiles(fileInput.files)

        : [];



      // 2) ÿÆÿ≤ŸëŸÜ ÿßŸÑÿ∑ŸÑÿ®

      const { data, error } = await supabase

        .from('homeowner_jobs')

        .insert([

          {

            homeowner_id: null,

            category: document.getElementById('hoCategory').value,

            title: title,

            summary: document.getElementById('hoSummary').value.trim(),

            city: document.getElementById('hoCity').value.trim(),

            state: document.getElementById('hoState').value.trim(),

            budget_from: document.getElementById('hoBudgetFrom').value || null,

            budget_to: document.getElementById('hoBudgetTo').value || null,

            contact_name: contact,

            phone: phone,

            email: email,

            full_address: addr,

            description: desc,

            photo_paths: uploadedPaths  // ŸÑÿßÿ≤ŸÖ ŸäŸÉŸàŸÜ ÿßŸÑÿπŸÖŸàÿØ ŸÖŸàÿ¨ŸàÿØ ÿ£Ÿà ÿ™ÿ≠ÿ∞ŸÅŸá

          }

        ])

        .select()

        .single();



      if (error) {

        console.error(error);

        showError('Error: ' + error.message);

      } else {

        showSuccess('Job posted successfully!');

        document.getElementById('hoForm').reset();

      }



      btn.disabled = false;

      btn.textContent = 'üöÄ Post Job';

    }



    btn.addEventListener('click', postJob);

  </script>

</body>

</html>
