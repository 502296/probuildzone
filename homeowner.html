<!doctype html>

<html lang="en">

<head>

  <meta charset="utf-8" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Post a Job ‚Äì ProBuildZone</title>

  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

  <style>

    :root{

      --bg:#0f1730;

      --card:#0f1d35;

      --accent:#0ba5ff;

      --input:#0b1324;

      --border:#1f2b44;

    }

    *{box-sizing:border-box}

    body{

      margin:0;

      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;

      background:linear-gradient(160deg,#0b1021,#0f1730 60%,#0f1730);

      color:#fff;

      min-height:100vh;

      display:flex;

      justify-content:center;

      align-items:flex-start;

      padding:28px 12px 48px;

    }

    .wrapper{

      width:100%;

      max-width:720px;

      background:rgba(10,16,30,.3);

      border:1px solid rgba(255,255,255,.04);

      border-radius:18px;

      backdrop-filter:blur(14px);

      box-shadow:0 20px 50px rgba(0,0,0,.25);

      overflow:hidden;

    }

    .head{

      padding:16px 18px 10px;

      border-bottom:1px solid rgba(255,255,255,.03);

      display:flex;

      justify-content:space-between;

      align-items:center;

      gap:10px;

    }

    h1{

      font-size:20px;

      margin:0;

    }

    .btn-small{

      background:rgba(255,255,255,.04);

      border:1px solid rgba(255,255,255,.08);

      border-radius:10px;

      color:#fff;

      padding:6px 12px;

      cursor:pointer;

    }

    form{

      padding:16px 18px 22px;

    }

    label{

      display:block;

      font-weight:500;

      margin-bottom:6px;

    }

    input,select,textarea{

      width:100%;

      background:rgba(0,0,0,.25);

      border:1px solid rgba(255,255,255,.03);

      border-radius:10px;

      padding:10px 12px;

      color:#fff;

      font:inherit;

      outline:none;

    }

    input:focus,select:focus,textarea:focus{

      border-color:rgba(11,165,255,.6);

      background:rgba(11,165,255,.06);

    }

    textarea{min-height:110px;resize:vertical}

    .grid{

      display:grid;

      grid-template-columns:repeat(auto-fit,minmax(210px,1fr));

      gap:12px 14px;

    }

    .full{grid-column:1/-1}

    .upload-box{

      border:1px dashed rgba(255,255,255,.15);

      background:rgba(0,0,0,.12);

      border-radius:12px;

      padding:12px 12px 6px;

      margin-bottom:14px;

    }

    .upload-box small{opacity:.6}

    .actions{

      margin-top:18px;

      display:flex;

      justify-content:flex-start;

      gap:10px;

      align-items:center;

    }

    .btn-main{

      background:var(--accent);

      border:none;

      color:#fff;

      font-weight:600;

      border-radius:15px;

      padding:11px 26px;

      cursor:pointer;

      display:inline-flex;

      gap:6px;

      align-items:center;

    }

    #hoError{

      margin-top:12px;

      background:rgba(255,69,58,.12);

      border:1px solid rgba(255,69,58,.35);

      border-radius:10px;

      padding:10px 12px;

      color:#ffd6d2;

      display:none;

      white-space:pre-wrap;

    }

    #hoSuccess{

      margin-top:12px;

      background:rgba(35,195,81,.12);

      border:1px solid rgba(35,195,81,.3);

      border-radius:10px;

      padding:10px 12px;

      color:#dcffe5;

      display:none;

    }

    @media (max-width:540px){

      .head{flex-wrap:wrap}

      .actions{flex-direction:column;align-items:flex-start}

      .btn-main{width:100%;justify-content:center}

    }

  </style>

</head>

<body>



  <div class="wrapper">

    <div class="head">

      <button class="btn-small" type="button" onclick="history.back()">‚Üê Back</button>

      <h1>Post a Job</h1>

      <button class="btn-small" type="button" onclick="location.href='/'">Close</button>

    </div>



    <form id="hoForm">

      <!-- ÿ±ŸÅÿπ ÿßŸÑÿµŸàÿ± -->

      <div class="upload-box">

        <label for="hoPhotos">üìÅ Choose Photos/Files</label>

        <input id="hoPhotos" type="file" multiple>

        <small>You can select multiple photos or a PDF (optional)</small>

      </div>



      <div class="grid">

        <div class="full">

          <label for="hoTitle">Project title *</label>

          <input id="hoTitle" placeholder="e.g., Replace leaking roof" required>

        </div>

        <div class="full">

          <label for="hoSummary">Short summary</label>

          <input id="hoSummary" placeholder="One or two lines...">

        </div>

        <div>

          <label for="hoCity">City *</label>

          <input id="hoCity" placeholder="Enter your city" required>

        </div>

        <div>

          <label for="hoState">State *</label>

          <input id="hoState" placeholder="Enter your state" required>

        </div>

        <div>

          <label for="hoBudgetFrom">Budget From ($)</label>

          <input id="hoBudgetFrom" type="number" min="0" step="1" placeholder="From">

        </div>

        <div>

          <label for="hoBudgetTo">Budget To ($)</label>

          <input id="hoBudgetTo" type="number" min="0" step="1" placeholder="To">

        </div>

        <div>

          <label for="hoContactName">Contact name *</label>

          <input id="hoContactName" placeholder="Your name" required>

        </div>

        <div>

          <label for="hoPhone">Phone *</label>

          <input id="hoPhone" placeholder="Your phone number" required>

        </div>

        <div>

          <label for="hoEmail">Email *</label>

          <input id="hoEmail" type="email" placeholder="you@example.com" required>

        </div>

        <div class="full">

          <label for="hoFullAddress">Full address *</label>

          <input id="hoFullAddress" placeholder="Street, City, State" required>

        </div>

        <div class="full">

          <label for="hoDescription">Full description *</label>

          <textarea id="hoDescription" placeholder="Describe the job in detail..." required></textarea>

        </div>

      </div>



      <div id="hoError"></div>

      <div id="hoSuccess"></div>



      <div class="actions">

        <button id="hoPostBtn" type="button" class="btn-main">üöÄ Post Job</button>

      </div>

    </form>

  </div>



  <!-- supabase js -->

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.48.0/dist/umd/supabase.min.js"></script>

  <script>

    // ‚úèÔ∏è ÿ∫ŸäŸëÿ± Ÿáÿ∞ŸàŸÑ ÿßŸÑÿ≥ÿ∑ÿ±ŸäŸÜ ŸÖŸÜ ŸÖÿ¥ÿ±ŸàÿπŸÉ

    const SUPABASE_URL = 'https://hczahffwghbddqabpbmu.supabase.co';

    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhjemFoZmZ3Z2hiZGRxYWJwYm11Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIzNDc1ODIsImV4cCI6MjA3NzkyMzU4Mn0.rpPNAFSKYhDRu8FTVRX2HZFHmyfpOgqflaKf3LrxPoU';



    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);



    const form = document.getElementById('hoForm');

    const btn = document.getElementById('hoPostBtn');

    const errBox = document.getElementById('hoError');

    const okBox = document.getElementById('hoSuccess');



    function showErr(msg){

      errBox.textContent = 'Error: ' + msg;

      errBox.style.display = 'block';

      okBox.style.display = 'none';

    }

    function showOk(msg){

      okBox.textContent = msg;

      okBox.style.display = 'block';

      errBox.style.display = 'none';

    }



    async function uploadFiles(files, jobId){

      const paths = [];

      for (const file of files){

        const fileName = `${jobId}/${Date.now()}-${file.name}`;

        const { data, error } = await supabase

          .storage

          .from('homeowner_uploads')

          .upload(fileName, file);

        if (error){

          console.warn('upload error', error.message);

          continue;

        }

        paths.push(fileName);

        // ÿßÿÆÿ™Ÿäÿßÿ±Ÿä: ÿÆÿ≤ŸëŸÜŸáÿß ÿ®ÿ¨ÿØŸàŸÑ ÿ´ÿßŸÜŸä

        await supabase.from('homeowner_job_photos').insert({

          job_id: jobId,

          path: fileName

        });

      }

      return paths;

    }



    async function postJob(){

      errBox.style.display = 'none';

      okBox.style.display = 'none';



      const title = document.getElementById('hoTitle').value.trim();

      const summary = document.getElementById('hoSummary').value.trim();

      const city = document.getElementById('hoCity').value.trim();

      const state = document.getElementById('hoState').value.trim();

      const budget_from = document.getElementById('hoBudgetFrom').value.trim();

      const budget_to = document.getElementById('hoBudgetTo').value.trim();

      const contact_name = document.getElementById('hoContactName').value.trim();

      const phone = document.getElementById('hoPhone').value.trim();

      const email = document.getElementById('hoEmail').value.trim();

      const full_address = document.getElementById('hoFullAddress').value.trim();

      const description = document.getElementById('hoDescription').value.trim();

      const files = document.getElementById('hoPhotos').files;



      if (!title || !city || !state || !contact_name || !phone || !email || !full_address || !description){

        showErr('Please fill all required fields.');

        return;

      }



      btn.disabled = true;

      btn.textContent = 'Posting...';



      // 1) ÿ£ÿ∂ŸÅ ÿßŸÑÿµŸÅ ŸÅŸä homeowner_jobs

      const { data, error } = await supabase

        .from('homeowner_jobs')

        .insert({

          category: null,        // ÿßŸÜÿ™ ÿ®ÿπÿØŸäŸÜ ÿ™ÿ≠ÿ∑Ÿáÿß ŸÖŸÜ ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿ£ŸäŸÇŸàŸÜÿ©

          title,

          summary,

          city,

          state,

          budget_from: budget_from ? Number(budget_from) : null,

          budget_to: budget_to ? Number(budget_to) : null,

          contact_name,

          phone,

          email,

          full_address,

          description

        })

        .select('id')

        .single();



      if (error){

        showErr(error.message);

        btn.disabled = false;

        btn.textContent = 'üöÄ Post Job';

        return;

      }



      const jobId = data.id;



      // 2) ÿßÿ±ŸÅÿπ ÿßŸÑŸÖŸÑŸÅÿßÿ™ (ŸÑŸà ŸÅŸäŸá)

      if (files && files.length > 0){

        await uploadFiles(files, jobId);

      }



      showOk('Job posted successfully!');

      form.reset();

      btn.disabled = false;

      btn.textContent = 'üöÄ Post Job';

    }



    btn.addEventListener('click', postJob);

  </script>

</body>

</html>
