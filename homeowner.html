<!DOCTYPE html>

<html lang="en">

<head>

  <meta charset="UTF-8" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <title>ProBuildZone ‚Äî Post a Job</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <style>

    :root{

      --bg:#f6f7fb; --ink:#0f2a43; --card:#fff; --muted:#6b7a8c; --ok:#157347; --err:#b00020; --btn:#0f2a43; --btnH:#143756;

    }

    *{box-sizing:border-box}

    body{font-family:Inter,system-ui,Segoe UI,Arial,sans-serif;background:var(--bg);color:var(--ink);margin:0;padding:32px}

    h1{margin:0 0 8px;text-align:center}

    p.lead{margin:0 0 24px;text-align:center;color:var(--muted)}

    form{max-width:560px;margin:0 auto;background:var(--card);padding:24px;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,.06)}

    label{display:block;font-weight:600;margin:10px 0 6px}

    input,textarea{width:100%;padding:12px 14px;border:1px solid #d9dde4;border-radius:8px;font-size:16px;outline:none}

    input:focus,textarea:focus{border-color:#9bb7d7;box-shadow:0 0 0 3px rgba(58,121,207,.15)}

    textarea{resize:vertical;min-height:110px}

    .row{display:flex;gap:12px}

    .row > div{flex:1}

    button{width:100%;margin-top:12px;padding:14px 16px;border:0;border-radius:10px;background:var(--btn);color:#fff;font-weight:700;font-size:16px;cursor:pointer;transition:.18s}

    button:hover{background:var(--btnH)}

    button[disabled]{opacity:.65;cursor:not-allowed}

    #msg{margin-top:12px;text-align:center;font-weight:600}

    #msg.ok{color:var(--ok)}

    #msg.err{color:var(--err)}

    .hint{font-size:12px;color:var(--muted);margin-top:4px}

  </style>

</head>

<body>

  <h1>üè° Post Your Project</h1>

  <p class="lead">Tell us about your home project. Local pros will send offers.</p>



  <form id="job-form" novalidate>

    <label for="title">Project title *</label>

    <input id="title" type="text" placeholder="e.g., Build a new porch roof" required>



    <label for="summary">Short summary</label>

    <input id="summary" type="text" placeholder="One line about the project (optional)">



    <div class="row">

      <div>

        <label for="name">Full name *</label>

        <input id="name" type="text" placeholder="Your full name" required>

      </div>

      <div>

        <label for="phone">Phone</label>

        <input id="phone" type="tel" placeholder="(optional)">

      </div>

    </div>



    <div class="row">

      <div>

        <label for="email">Email *</label>

        <input id="email" type="email" placeholder="you@email.com" required>

      </div>

      <div>

        <label for="address">Full address *</label>

        <input id="address" type="text" placeholder="Street, City, State" required>

      </div>

    </div>



    <label for="description">Full description *</label>

    <textarea id="description" placeholder="Describe the work you need" required></textarea>

    <div class="hint">Fields marked * are required.</div>



    <button id="submitBtn" type="submit">üöÄ Post Job</button>

    <div id="msg" role="status" aria-live="polite"></div>

  </form>



  <script>

    const form = document.getElementById('job-form');

    const btn  = document.getElementById('submitBtn');

    const msg  = document.getElementById('msg');



    const setMsg = (text, cls='') => {

      msg.className = ''; if (cls) msg.classList.add(cls);

      msg.textContent = text;

    };



    form.addEventListener('submit', async (e) => {

      e.preventDefault();

      setMsg('');

      btn.disabled = true;

      const original = btn.textContent;

      btn.textContent = 'Saving to database‚Ä¶';



      const payload = {

        title:       document.getElementById('title').value.trim() || null,

        summary:     document.getElementById('summary').value.trim() || null,

        name:        document.getElementById('name').value.trim(),

        email:       document.getElementById('email').value.trim(),

        phone:       document.getElementById('phone').value.trim() || null,

        address:     document.getElementById('address').value.trim(),

        description: document.getElementById('description').value.trim(),

      };



      // basic required validation on the client

      if (!payload.name || !payload.email || !payload.address || !payload.description) {

        setMsg('Please fill all required fields.', 'err');

        btn.textContent = original; btn.disabled = false;

        return;

      }



      try {

        const res = await fetch('/.netlify/functions/post-job', {

          method: 'POST',

          headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },

          body: JSON.stringify(payload)

        });



        // Force JSON; if HTML arrives (like a 404 page), throw readable error

        const text = await res.text();

        let data;

        try { data = JSON.parse(text); }

        catch { throw new Error(`Non-JSON response (${res.status}). First bytes: ${text.slice(0,80)}‚Ä¶`); }



        if (!res.ok) throw new Error(data.error || 'Failed to post job');



        setMsg('‚úÖ Job posted successfully!', 'ok');

        form.reset();

      } catch (err) {

        console.error(err);

        setMsg(`Error: ${err.message}`, 'err');

      } finally {

        btn.textContent = original;

        btn.disabled = false;

      }

    });

  </script>

</body>

</html>
