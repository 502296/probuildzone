<!doctype html>

<html lang="en">

<head>

  <meta charset="utf-8" />

  <title>Post a Job ‚Äî ProBuildZone</title>

  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>

    :root{

      --bg:#0F2A43;

      --card:#111827;

      --input:#1f2937;

      --border:#374151;

      --accent:#36BFFA;

      --accent2:#d4af37;

      --muted:#9ca3af;

    }

    *{box-sizing:border-box}

    body{

      margin:0;

      min-height:100vh;

      background:radial-gradient(circle at top, #133455 0%, #0F2A43 35%, #020617 100%);

      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;

      color:#fff;

      display:flex;

      justify-content:center;

      align-items:flex-start;

      padding:32px 12px 60px;

    }

    .wrapper{

      width:100%;

      max-width:980px;

    }

    h1{

      margin-bottom:18px;

      font-size:28px;

      font-weight:700;

    }

    .card{

      background:rgba(2,6,23,.5);

      border:1px solid rgba(148,163,184,.15);

      border-radius:18px;

      padding:20px 18px 26px;

      backdrop-filter: blur(4px);

    }

    label{

      display:block;

      font-weight:500;

      margin-bottom:6px;

    }

    input, select, textarea{

      width:100%;

      background:var(--input);

      border:1px solid rgba(148,163,184,.25);

      border-radius:12px;

      padding:10px 12px;

      color:#fff;

      font:inherit;

    }

    input::placeholder, textarea::placeholder{

      color:rgba(255,255,255,.28);

    }

    textarea{

      min-height:120px;

      resize:vertical;

    }

    .two{

      display:grid;

      gap:12px;

    }

    @media (min-width:720px){

      .two{grid-template-columns:repeat(2, minmax(0,1fr));}

    }

    .upload-box{

      border:1px dashed rgba(148,163,184,.4);

      border-radius:14px;

      padding:12px 14px 14px;

      margin-bottom:16px;

      background:rgba(15,23,42,.25);

    }

    .upload-box small{

      color:rgba(255,255,255,.35);

      display:block;

      margin-top:4px;

    }

    .btn{

      display:inline-flex;

      align-items:center;

      justify-content:center;

      gap:6px;

      border:none;

      background:#36BFFA;

      color:#000;

      font-weight:600;

      border-radius:14px;

      padding:11px 18px;

      cursor:pointer;

      font-size:15px;

    }

    .btn[disabled]{

      opacity:.6;

      cursor:not-allowed;

    }

    #ho-msg{

      margin-top:14px;

      font-weight:500;

      text-align:center;

    }

    .note{

      font-size:13px;

      color:rgba(255,255,255,.5);

      margin-bottom:14px;

    }

  </style>

</head>

<body>

  <div class="wrapper">

    <h1>Post a Job</h1>

    <div class="card">

      <!-- ÿ±ŸÅÿπ ÿßŸÑÿµŸàÿ± -->

      <div class="upload-box">

        <label for="hoPhotos">üì∏ Choose Photos/Files</label>

        <input id="hoPhotos" type="file" multiple>

        <small>You can select multiple photos or a PDF plan. Drag & drop is supported (optional).</small>

      </div>



      <!-- ÿßŸÑÿπŸÜŸàÿßŸÜ ŸàÿßŸÑŸÖŸÑÿÆÿµ -->

      <div>

        <label for="hoTitle">Project title *</label>

        <input id="hoTitle" placeholder="e.g., Replace leaking roof" required>

      </div>

      <div style="margin-top:12px">

        <label for="hoSummary">Short summary</label>

        <input id="hoSummary" placeholder="One or two lines...">

      </div>



      <!-- ÿßŸÑŸÖÿØŸäŸÜÿ© ŸàÿßŸÑŸàŸÑÿßŸäÿ© -->

      <div class="two" style="margin-top:14px">

        <div>

          <label for="hoCity">City</label>

          <input id="hoCity" placeholder="Enter your city">

        </div>

        <div>

          <label for="hoState">State</label>

          <input id="hoState" placeholder="Enter your state">

        </div>

      </div>



      <!-- ÿßŸÑŸÖŸäÿ≤ÿßŸÜŸäÿ© -->

      <div class="two" style="margin-top:14px">

        <div>

          <label for="hoBudgetFrom">Budget From ($)</label>

          <input id="hoBudgetFrom" type="number" min="0" placeholder="From ($)">

        </div>

        <div>

          <label for="hoBudgetTo">To ($)</label>

          <input id="hoBudgetTo" type="number" min="0" placeholder="To ($)">

        </div>

      </div>



      <!-- ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ™ŸàÿßÿµŸÑ -->

      <div class="two" style="margin-top:14px">

        <div>

          <label for="hoContactName">Contact name *</label>

          <input id="hoContactName" placeholder="Your name" required>

        </div>

        <div>

          <label for="hoPhone">Phone *</label>

          <input id="hoPhone" placeholder="Your phone number" required>

        </div>

      </div>



      <div class="two" style="margin-top:14px">

        <div>

          <label for="hoEmail">Email *</label>

          <input id="hoEmail" type="email" placeholder="Your email address" required>

        </div>

        <div>

          <label for="hoFullAddress">Full address *</label>

          <input id="hoFullAddress" placeholder="Street, City, State" required>

        </div>

      </div>



      <!-- ÿßŸÑŸàÿµŸÅ -->

      <div style="margin-top:14px">

        <label for="hoDescription">Full description *</label>

        <textarea id="hoDescription" placeholder="Describe the job in detail..."></textarea>

      </div>



      <p class="note">Only ZIP / title / photos will be shown to pros. Full contact details stay hidden until homeowner accepts an offer.</p>



      <button id="hoPostBtn" class="btn" type="button">üöÄ Post Job</button>

      <div id="ho-msg"></div>

    </div>

  </div>



  <!-- Supabase CDN -->

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>



  <script>
    const SUPABASE_URL = 'https://hczahffwghbddqabpbmu.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhjemFoZmZ3Z2hiZGRxYWJwYm11Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIzNDc1ODIsImV4cCI6MjA3NzkyMzU4Mn0.rpPNAFSKYhDRu8FTVRX2HZFHmyfpOgqflaKf3LrxPoU';
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);



    // 3) ŸÖÿ±ÿßÿ¨ÿπ ÿßŸÑÿπŸÜÿßÿµÿ±

    const fileInput    = document.getElementById('hoPhotos');

    const titleInput   = document.getElementById('hoTitle');

    const summaryInput = document.getElementById('hoSummary');

    const cityInput    = document.getElementById('hoCity');

    const stateInput   = document.getElementById('hoState');

    const budgetFrom   = document.getElementById('hoBudgetFrom');

    const budgetTo     = document.getElementById('hoBudgetTo');

    const contactInput = document.getElementById('hoContactName');

    const phoneInput   = document.getElementById('hoPhone');

    const emailInput   = document.getElementById('hoEmail');

    const addressInput = document.getElementById('hoFullAddress');

    const descInput    = document.getElementById('hoDescription');

    const postBtn      = document.getElementById('hoPostBtn');

    const msgBar       = document.getElementById('ho-msg');



    function showMsg(txt, isErr = false){

      msgBar.textContent = txt;

      msgBar.style.color = isErr ? '#ffb4b4' : '#baffc9';

    }



    // 4) ÿ±ŸÅÿπ ÿßŸÑŸÖŸÑŸÅÿßÿ™ ÿ•ŸÑŸâ bucket homeowner_uploads

    async function uploadJobFiles(files){

      const bucket = 'homeowner_uploads';

      const urls = [];



      for (const file of files){

        const ext = file.name.split('.').pop();

        const newName = `job-${Date.now()}-${Math.random().toString(36).slice(2)}.${ext}`;



        const { data, error } = await supabase

          .storage

          .from(bucket)

          .upload(newName, file);



        if (error){

          console.warn('upload error', error.message);

          continue; // ŸÜŸÉŸÖŸÑ ÿ≠ÿ™Ÿâ ŸÑŸà ŸÅÿ¥ŸÑ Ÿàÿßÿ≠ÿØ

        }



        const { data: pub } = supabase

          .storage

          .from(bucket)

          .getPublicUrl(newName);



        if (pub?.publicUrl){

          urls.push(pub.publicUrl);

        }

      }



      return urls;

    }



    // 5) ÿ≠ÿØÿ´ ÿßŸÑÿ•ÿ±ÿ≥ÿßŸÑ

    postBtn.addEventListener('click', async () => {

      // ÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖŸáŸÖÿ©

      if (!titleInput.value.trim() ||

          !contactInput.value.trim() ||

          !phoneInput.value.trim() ||

          !emailInput.value.trim() ||

          !addressInput.value.trim() ||

          !descInput.value.trim()){

        showMsg('Please fill required fields (title, contact, phone, email, address, description).', true);

        return;

      }



      postBtn.disabled = true;

      const prevLabel = postBtn.textContent;

      postBtn.textContent = 'Posting...';

      showMsg('');



      try {

        // ÿ±ŸÅÿπ ÿßŸÑÿµŸàÿ± (ŸÑŸà ŸÅŸäŸá)

        let photoUrls = [];

        if (fileInput.files && fileInput.files.length){

          photoUrls = await uploadJobFiles(fileInput.files);

        }



        // ÿ•ÿØÿÆÿßŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™

        const { data, error } = await supabase

          .from('homeowner_jobs')

          .insert([{

            category: 'General',

            title: titleInput.value.trim(),

            summary: summaryInput.value.trim(),

            city: cityInput.value.trim(),

            state: stateInput.value.trim(),

            zip: '',                // ÿ™ŸÇÿØÿ± ÿ™ÿ∂ŸäŸÅ ÿ≠ŸÇŸÑ ZIP ÿ®ÿπÿØŸäŸÜ

            budget_from: budgetFrom.value.trim(),

            budget_to: budgetTo.value.trim(),

            contact_name: contactInput.value.trim(),

            phone: phoneInput.value.trim(),

            email: emailInput.value.trim(),

            full_address: addressInput.value.trim(),

            description: descInput.value.trim(),

            photo_urls: photoUrls.length ? photoUrls : null

          }])

          .select()

          .single();



        if (error){

          console.error(error);

          showMsg('DB error: ' + error.message, true);

        } else {

          showMsg('Job posted successfully! ‚úÖ');

          // ÿ™ŸÅÿ±Ÿäÿ∫ ÿßŸÑÿ≠ŸÇŸàŸÑ

          titleInput.value = '';

          summaryInput.value = '';

          cityInput.value = '';

          stateInput.value = '';

          budgetFrom.value = '';

          budgetTo.value = '';

          contactInput.value = '';

          phoneInput.value = '';

          emailInput.value = '';

          addressInput.value = '';

          descInput.value = '';

          if (fileInput.value) fileInput.value = '';

        }



      } catch (err){

        console.error(err);

        showMsg('Unexpected error: ' + err.message, true);

      } finally {

        postBtn.disabled = false;

        postBtn.textContent = prevLabel;

      }

    });

  </script>

</body>

</html>
