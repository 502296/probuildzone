<!doctype html>

<html lang="en" dir="ltr">

<head>

  <meta charset="utf-8" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Send an Offer – ProBuildZone</title>

  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <style>

    :root {

      --pbz: #0F2A43;

      --gold: #D4AF37;

      --muted: #617186;

      --bg: #f3f5f7;

      --danger: #b91c1c;

      --success: #166534;

    }

    * { box-sizing: border-box; }

    body {

      margin: 0;

      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;

      background: var(--bg);

      color: var(--pbz);

    }

    .page {

      max-width: 760px;

      margin: 28px auto 40px;

      padding: 0 16px;

    }

    .header {

      margin-bottom: 18px;

    }

    .logo {

      font-weight: 700;

      letter-spacing: 0.04em;

      text-transform: uppercase;

      font-size: 14px;

      color: var(--muted);

    }

    h1 {

      margin: 6px 0 8px;

      font-size: 24px;

    }

    .job-tag {

      font-size: 14px;

      color: var(--muted);

    }

    .card {

      background: #fff;

      border-radius: 16px;

      border: 1px solid #e3e7eb;

      padding: 18px 16px 20px;

      box-shadow: 0 6px 22px rgba(0,0,0,.03);

    }

    label {

      display: block;

      font-weight: 600;

      margin-bottom: 6px;

      font-size: 14px;

    }

    input, textarea {

      width: 100%;

      padding: 11px 12px;

      border-radius: 10px;

      border: 1px solid #d5d9de;

      font: inherit;

      background: #fff;

    }

    textarea {

      min-height: 120px;

      resize: vertical;

    }

    .field {

      margin-bottom: 14px;

    }

    .hint {

      font-size: 12px;

      color: var(--muted);

      margin-top: 4px;

    }

    .actions {

      margin-top: 18px;

      display: flex;

      gap: 10px;

      flex-wrap: wrap;

    }

    button {

      border: none;

      cursor: pointer;

      font-weight: 600;

      font-family: inherit;

    }

    .btn-main {

      background: var(--gold);

      color: #000;

      padding: 11px 18px;

      border-radius: 10px;

      min-width: 140px;

    }

    .btn-secondary {

      background: #edf0f3;

      color: var(--pbz);

      padding: 11px 18px;

      border-radius: 10px;

    }

    .alert {

      margin-top: 12px;

      border-radius: 10px;

      padding: 10px 12px;

      font-size: 13px;

      display: none;

      white-space: pre-wrap;

    }

    .alert.error {

      background: #fef2f2;

      border: 1px solid #fecaca;

      color: var(--danger);

    }

    .alert.success {

      background: #ecfdf3;

      border: 1px solid #bbf7d0;

      color: var(--success);

    }

    .note {

      margin-top: 16px;

      font-size: 13px;

      color: var(--muted);

      line-height: 1.5;

    }

    @media (max-width: 540px) {

      .card { padding: 16px 14px 20px; }

      .actions { flex-direction: column; }

      .btn-main, .btn-secondary { width: 100%; text-align: center; }

    }

  </style>

</head>

<body>

  <div class="page">

    <div class="header">

      <div class="logo">PROBUILDZONE</div>

      <h1>Send an offer</h1>

      <div id="jobTag" class="job-tag"></div>

    </div>



    <div class="card">

      <form id="offerForm" novalidate autocomplete="off">

        <!-- نخزّن الـ public_id في متغير JS، ما نعرضه للمستخدم -->

        <div class="field">

          <label for="business_name">Business / Pro name</label>

          <input id="business_name" name="business_name" placeholder="John &amp; Sons Builders" required>

        </div>



        <div class="field">

          <label for="pro_email">Your email (optional but recommended)</label>

          <input id="pro_email" name="pro_email" type="email" placeholder="you@example.com">

          <div class="hint">

            If you add your email, the homeowner can simply hit “Reply” on the email we send them.

          </div>

        </div>



        <div class="field">

          <label for="phone">Phone number</label>

          <input id="phone" name="phone" placeholder="5022968111" required>

        </div>



        <div class="field">

          <label for="amount">Estimated price (USD)</label>

          <input id="amount" name="amount" type="number" step="0.01" placeholder="2500" required>

          <div class="hint">You can fine-tune the final price after you talk to the homeowner.</div>

        </div>



        <div class="field">

          <label for="message">Message / details (optional)</label>

          <textarea id="message" name="message" placeholder="Briefly describe what’s included, timeline, or any warranty..."></textarea>

        </div>



        <div id="alert" class="alert error"></div>

        <div id="success" class="alert success"></div>



        <div class="actions">

          <button type="button" class="btn-secondary" id="cancelBtn">Back</button>

          <button type="submit" class="btn-main" id="sendBtn">Send offer</button>

        </div>



        <div class="note">

          ProBuildZone simply connects homeowners and local Pros.

          All project details, payments, and agreements are handled directly between you and the homeowner.

        </div>

      </form>

    </div>

  </div>



  <script>

    function getJobPublicId() {

      try {

        const params = new URLSearchParams(window.location.search);

        return params.get('job') || params.get('job_public_id') || '';

      } catch (e) {

        return '';

      }

    }



    const jobPublicId = getJobPublicId();



    const jobTagEl = document.getElementById('jobTag');

    if (jobPublicId) {

      jobTagEl.textContent = 'For job: ' + jobPublicId;

    } else {

      jobTagEl.textContent = 'Job ID missing – please open this page from the project link.';

    }



    const form = document.getElementById('offerForm');

    const alertBox = document.getElementById('alert');

    const successBox = document.getElementById('success');

    const sendBtn = document.getElementById('sendBtn');

    const cancelBtn = document.getElementById('cancelBtn');



    function showError(msg) {

      alertBox.textContent = msg;

      alertBox.style.display = 'block';

      successBox.style.display = 'none';

    }



    function showSuccess(msg) {

      successBox.textContent = msg;

      successBox.style.display = 'block';

      alertBox.style.display = 'none';

    }



    function clearMessages() {

      alertBox.style.display = 'none';

      successBox.style.display = 'none';

      alertBox.textContent = '';

      successBox.textContent = '';

    }



    cancelBtn.addEventListener('click', () => {

      // ترجع صفحة واحدة للخلف – تقدر تغيّرها لو تحب

      window.history.back();

    });



    form.addEventListener('submit', async (e) => {

      e.preventDefault();

      clearMessages();



      if (!jobPublicId) {

        showError('Job ID is missing. Please go back and open this offer page from the project link.');

        return;

      }



      const business_name = document.getElementById('business_name').value.trim();

      const pro_email = document.getElementById('pro_email').value.trim();

      const phone = document.getElementById('phone').value.trim();

      const amount = document.getElementById('amount').value.trim();

      const message = document.getElementById('message').value.trim();



      if (!business_name || !phone || !amount) {

        showError('Please fill business name, phone, and estimated price.');

        return;

      }



      const payload = {

        job_public_id: jobPublicId,

        business_name,

        pro_email: pro_email || null,

        phone,

        amount,

        message

      };



      sendBtn.disabled = true;

      sendBtn.textContent = 'Sending...';



      try {

        const res = await fetch('/.netlify/functions/post-offer', {

          method: 'POST',

          headers: { 'Content-Type': 'application/json' },

          body: JSON.stringify(payload),

        });



        const data = await res.json().catch(() => ({}));



        if (!res.ok || !data.ok) {

          console.error('post-offer error:', data);

          showError(data.error || 'Something went wrong while sending your offer. Please try again.');

        } else {

          showSuccess('Your offer has been sent to the homeowner. They will contact you directly if it’s a good fit.');

          // لو تحب: فعّل السطر التالي للانتقال إلى thankyou.html

          // window.location.href = 'thankyou.html';

          form.reset();

        }

      } catch (err) {

        console.error(err);

        showError('Network error. Please check your connection and try again.');

      } finally {

        sendBtn.disabled = false;

        sendBtn.textContent = 'Send offer';

      }

    });

  </script>

</body>

</html>
