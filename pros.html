<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ProBuildZone — For Pros</title>
<meta name="description" content="ProBuildZone Pro Onboarding">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
:root{
--pbz-blue:#0F2A43;
--pbz-blue-2:#0b2033;
--gold:#D4AF37;
--gold-700:#b9962f;
--muted:#6b7a8c;
--bg:#f6f7fb;
--card:#ffffff;
--error:#b00020;
--ok:#0a8f55;
}

*{box-sizing:border-box}
html,body{height:100%}
body{
margin:0;
font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
color:#111;
background:linear-gradient(180deg, #0f2a43 0%, #103252 35%, #0f2a43 100%) fixed;
}

/* Header */
header{
position:sticky; top:0; z-index:50;
background:rgba(255,255,255,.06);
backdrop-filter: blur(6px);
border-bottom:1px solid rgba(255,255,255,.12);
}
.nav{max-width:980px; margin:0 auto; display:flex; align-items:center; gap:14px; padding:10px 16px; color:#fff}
.brand{display:flex; align-items:center; gap:10px; text-decoration:none; color:#fff}
.brand img{height:28px; width:auto; display:block}
.name{font-weight:800; letter-spacing:.3px}

/* Main wrapper */
.wrap{max-width:980px; margin:0 auto; padding:22px 16px 120px}

/* Hero */
.hero{
background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02));
border:1px solid rgba(255,255,255,.12);
color:#fff; border-radius:18px; padding:24px 22px; margin-bottom:18px;
box-shadow: 0 8px 24px rgba(0,0,0,.15);
}
.hero h1{margin:0 0 6px; font-size:26px}
.hero p{margin:0; color:#e6edf6}

/* Card */
.card{
background:var(--card); border-radius:18px; padding:20px;
border:1px solid #e7eef6; box-shadow: 0 10px 28px rgba(3,20,33,.15);
}

/* Form grid */
form{display:grid; grid-template-columns:1fr 1fr; gap:16px}
.span-2{grid-column:1 / -1}
.group label{display:block; font-weight:700; color:var(--pbz-blue); margin:4px 0 6px}
.group input, .group select, .group textarea{
width:100%; padding:12px 13px; border-radius:12px; border:1px solid #d7e1ec;
background:#fff; outline:0; font-size:15px;
}
.group input:focus, .group select:focus, .group textarea:focus{
border-color: var(--pbz-blue);
box-shadow: 0 0 0 3px rgba(15,42,67,.15);
}
textarea{min-height:110px; resize:vertical}

/* Agree (custom checkbox with golden outline) */
.agree{display:grid; grid-template-columns:26px 1fr; column-gap:12px; align-items:start; color:var(--muted); font-size:13px; line-height:1.5}
.agree input[type="checkbox"]{
appearance:none; -webkit-appearance:none; -moz-appearance:none;
width:26px; height:26px; border-radius:8px;
border:2px solid var(--gold); background:#fff; position:relative; cursor:pointer;
transition:background .15s ease, box-shadow .15s ease, border-color .15s ease, transform .05s ease;
}
.agree input[type="checkbox"]:active{ transform:scale(.98);}
.agree input[type="checkbox"]::after{
content:""; width:14px; height:14px; border-radius:4px; position:absolute; left:50%; top:50%; transform:translate(-50%,-50%) scale(0);
background:linear-gradient(180deg, var(--gold), var(--gold-700));
box-shadow: inset 0 0 0 2px rgba(255,255,255,.75);
transition:transform .12s ease-out;
}
.agree input[type="checkbox"]:checked::after{ transform:translate(-50%,-50%) scale(1); }
.agree a{color:var(--pbz-blue); font-weight:700; text-decoration:none}

/* Buttons */
.actions{display:flex; gap:12px; flex-wrap:wrap}
.btn{
display:inline-flex; align-items:center; justify-content:center;
padding:14px 18px; border-radius:14px; border:1px solid #e7e2cf; font-weight:800; letter-spacing:.2px; cursor:pointer; user-select:none; background:#fff;
transition:transform .05s ease, box-shadow .15s ease, background .15s ease, opacity .15s;
}
.btn[disabled]{opacity:.6; cursor:not-allowed}
.btn-gold{
color:var(--gold-700); border:0; background:#fff;
box-shadow:0 12px 24px rgba(244,192,69,.35);
}
.btn-gold:hover{ transform:translateY(-1px)}
.btn-gold:active{ transform:translateY(0)}
.btn-reset{background:#f0f4f8}

/* Fixed CTA on mobile */
.cta-bar{
position:fixed; left:0; right:0; bottom:0; z-index:60;
background:linear-gradient(180deg, rgba(255,255,255,0) 0%, rgba(255,255,255,.9) 18%, rgba(255,255,255,1) 38%);
padding:10px 12px 14px; border-top:1px solid #e7eef6;
display:none;
}
.cta-inner{max-width:980px; margin:0 auto; display:flex; gap:10px; justify-content:flex-end}
@media (max-width:768px){
.cta-bar{display:block}
}

/* Footer */
.footer{max-width:980px; margin:26px auto; color:#fff; font-size:12.5px; text-align:center}

/* Toast */
.toast{
position:fixed; left:50%; bottom:18px; transform:translateX(-50%);
background:#0F2A43; color:#fff; padding:12px 14px; border-radius:10px; box-shadow:0 10px 24px rgba(0,0,0,.18);
display:none; z-index:80; font-weight:700; letter-spacing:.2px; max-width:92%; text-align:center;
}
.toast.ok{background:var(--ok)}
.toast.err{background:var(--error)}
</style>
</head>
<body>
<header>
<div class="nav">
<a class="brand" href="/">
<img src="" alt="ProBuildZone Logo" onerror="this.style.display='none'">
<div class="name">ProBuildZone</div>
</a>
</div>
</header>

<main>
<div class="wrap">
<!-- Hero -->
<section class="hero">
<h1>ProBuildZone — For Pros</h1>
<p>Start your <strong>30-day free trial</strong>. Fair Prices • Local Pros</p>
</section>

<!-- Form Card -->
<section class="card">
<form id="prosForm" autocomplete="on">
<div class="group">
<label for="company">Company Name</label>
<input id="company" name="company" placeholder="Your company LLC" required>
</div>

<div class="group">
<label for="fullName">Your Name</label>
<input id="fullName" name="fullName" placeholder="Full name" required>
</div>

<div class="group">
<label for="email">Email</label>
<input id="email" name="email" type="email" placeholder="you@company.com" required>
</div>

<div class="group">
<label for="phone">Phone</label>
<input id="phone" name="phone" type="tel" inputmode="tel" placeholder="(502) 555-0123" required>
</div>

<div class="group span-2">
<label for="address">Business Address</label>
<input id="address" name="address" placeholder="Street, City, State" required>
</div>

<div class="group">
<label for="license">Business License</label>
<input id="license" name="license" placeholder="License # / State" required>
</div>

<div class="group">
<label for="insurance">Insurance (Optional)</label>
<select id="insurance" name="insurance">
<option value="">Not provided</option>
<option value="General Liability">General Liability</option>
<option value="Workers’ Comp">Workers’ Comp</option>
<option value="Both">Both</option>
</select>
</div>

<div class="group span-2">
<label for="services">Services & Notes (optional)</label>
<textarea id="services" name="services" placeholder="e.g., Decks, Roofing, Remodeling…"></textarea>
</div>

<div class="group span-2">
<label class="agree">
<input id="agree" type="checkbox" required>
<span>By starting your free trial, you agree to our <a href="terms.html" target="_blank" rel="noopener">Terms</a> &amp; <a href="privacy.html" target="_blank" rel="noopener">Privacy</a>.</span>
</label>
</div>

<div class="span-2 actions">
<button class="btn btn-reset" id="resetBtn" type="reset">Reset</button>
<!-- زر علوي (للديسكتوب) -->
<button class="btn btn-gold" id="startTrial" type="button" disabled>Start Free Trial</button>
</div>
</form>
</section>

<div class="footer"><span id="year"></span> ProBuildZone – Fair Prices • Local Pros</div>
</div>
</main>

<!-- CTA سفلية للموبايل -->
<div class="cta-bar">
<div class="cta-inner">
<button class="btn btn-gold" id="startTrialBottom" type="button" disabled>Start Free Trial</button>
</div>
</div>

<!-- Toast -->
<div id="toast" class="toast" role="status" aria-live="polite"></div>

<script>
const form = document.getElementById('prosForm');
const agree = document.getElementById('agree');
const btnTop = document.getElementById('startTrial');
const btnBottom = document.getElementById('startTrialBottom');
const toastEl = document.getElementById('toast');
const yearEl = document.getElementById('year');
yearEl.textContent = new Date().getFullYear();

function showToast(message, ok=false){
toastEl.textContent = message;
toastEl.classList.remove('ok','err');
toastEl.classList.add(ok ? 'ok' : 'err');
toastEl.style.display = 'block';
clearTimeout(showToast.t);
showToast.t = setTimeout(()=>{ toastEl.style.display='none'; }, 3800);
}

function formValid(){
const required = ['company','fullName','email','phone','address','license'];
for(const id of required){
const v = document.getElementById(id)?.value?.trim();
if(!v) return false;
}
const mail = document.getElementById('email').value.trim();
if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(mail)) return false;
return agree.checked;
}

function syncDisabled(){
const ok = formValid();
btnTop.disabled = !ok;
btnBottom.disabled = !ok;
}

form.addEventListener('input', syncDisabled);
agree.addEventListener('change', syncDisabled);
syncDisabled();

// جمع البيانات
function collectPayload(){
const data = new FormData(form);
const payload = Object.fromEntries(data.entries());
// خطة الاشتراك: سنة + تجربة 30 يوم
payload.plan = 'yearly';
payload.trialDays = 30;
return payload;
}

async function createStripeSession(payload){
try {
const response = await fetch('/.netlify/functions/create-checkout-session', {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify(payload)
});
const text = await response.text();
console.log('API Response:', response.status, text); // لفحص الرد
if (!response.ok) {
throw new Error(`Could not start checkout (${response.status}): ${text}`);
}
const session = JSON.parse(text);
if (session?.url && session.url.startsWith('http')) {
return session;
} else {
throw new Error('Invalid checkout URL received.');
}
} catch (err) {
console.error('Fetch error:', err);
throw err;
}
}

async function start(e){
e?.preventDefault?.();
const btn = (e?.currentTarget?.id === 'startTrialBottom') ? btnBottom : btnTop;
if (btn.disabled) return;
const prev = btn.textContent;
btn.textContent = 'Starting…';
btn.disabled = true;

try {
const payload = collectPayload();
const session = await createStripeSession(payload);
location.href = session.url;
} catch (err) {
console.error('Checkout error:', err);
showToast(err.message || 'Something went wrong. Please try again.', false);
btn.disabled = false;
btn.textContent = prev;
}
}

btnTop.addEventListener('click', start);
btnBottom.addEventListener('click', start);
document.getElementById('resetBtn').addEventListener('click', () => setTimeout(syncDisabled, 0));
</script>  
<button id="pay">Continue to Secure Payment</button>
<script>
  document.getElementById('pay').addEventListener('click', async () => {
    const res = await fetch('/.netlify/functions/create-checkout-session', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({
        customer_email: document.querySelector('#email')?.value || undefined,
        metadata: { source: 'pros_onboarding_v1' 
      })
    });
    const data = await res.json();
    if (data.url) {
      window.location.href = data.url;
    } else {
      alert('Something went wrong. Please try again.');
      console.error(data);
    }
  });
</script>
</body>
</html>
