<!doctype html>

<html lang="en" dir="ltr">

<head>

  <meta charset="utf-8"/>

  <meta name="viewport" content="width=device-width, initial-scale=1"/>

  <title>ProBuildZone — Start Free Trial</title>

  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

  <style>

    :root{

      --pbz-blue:#0F2A43; --pbz-blue-2:#0b2033; --gold:#D4AF37; --gold-700:#b9962f;

      --muted:#6b7a8c; --bg:#f6f7fb; --card:#ffffff; --error:#b00020; --ok:#0a8f55;

    }

    *{box-sizing:border-box}

    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:#fff;color:#111}

    .container{max-width:780px;margin:32px auto;padding:16px}

    h1{font-size:26px;margin:0 0 16px}

    .card{background:var(--card);border:1px solid #e7e8ec;border-radius:14px;padding:18px;box-shadow:0 6px 24px rgba(15,42,67,.06)}

    label{display:block;font-weight:600;margin:14px 0 6px}

    input,select,textarea{width:100%;padding:14px;border:1px solid #dcdfe5;border-radius:12px;font:inherit;background:#fff}

    textarea{min-height:120px;resize:vertical}

    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}

    .row .full{grid-column:1 / -1}

    .agree{display:flex;align-items:flex-start;gap:10px;margin-top:14px}

    .agree input{width:20px;height:20px;margin-top:2px}

    .actions{display:flex;gap:10px;margin-top:18px}

    .btn{padding:14px 18px;border-radius:12px;border:1px solid #dcdfe5;background:#f8f9fb}

    .btn-gold{background:var(--gold);border-color:var(--gold-700);color:#111;font-weight:700}

    .alert{margin-top:16px;border-radius:12px;padding:14px;border:1px solid #f2c8c8;background:#fdeeee;color:#9a1c1c;white-space:pre-wrap}

    .hidden{display:none}

  </style>

</head>

<body>

  <div class="container">

    <h1>ProBuildZone — Start Free Trial</h1>



    <div class="card">

      <form id="prosForm" novalidate>

        <div class="row">

          <div>

            <label for="name">Business / Owner name</label>

            <input id="name" name="name" placeholder="John & Sons Builders" required>

          </div>

          <div>

            <label for="email">Email</label>

            <input id="email" name="email" type="email" placeholder="you@example.com" required>

          </div>

        </div>



        <div class="row">

          <div>

            <label for="phone">Phone</label>

            <input id="phone" name="phone" placeholder="5022968111" required>

          </div>

          <div>

            <label for="address">Business address</label>

            <input id="address" name="address" placeholder="266 Eldorado Ave">

          </div>

        </div>



        <div class="row">

          <div>

            <label for="license">Business license / #</label>

            <input id="license" name="license" placeholder="KY-123456" required>

          </div>

          <div>

            <label for="insurance">Insurance (Optional)</label>

            <select id="insurance" name="insurance">

              <option value="">— Select —</option>

              <option>General Liability</option>

              <option>Workers’ Compensation</option>

              <option>Bonded</option>

            </select>

          </div>

        </div>



        <div class="row">

          <div class="full">

            <label for="notes">Services & notes (optional)</label>

            <textarea id="notes" name="notes" placeholder="Short description of services..."></textarea>

          </div>

        </div>



        <div class="agree">

          <input id="agree" type="checkbox" required checked>

          <label for="agree">By starting your free trial, you agree to our

            <a href="/terms.html" target="_blank">Terms</a> & <a href="/privacy.html" target="_blank">Privacy</a>.

          </label>

        </div>



        <div id="alert" class="alert hidden"></div>



        <div class="actions">

          <button type="reset" class="btn">Reset</button>

          <!-- مهم: button وليس submit -->

          <button id="startBtn" type="button" class="btn btn-gold">Start Free Trial</button>

        </div>

      </form>

    </div>

  </div>



  <script>

    const $ = (s)=>document.querySelector(s);

    const alertBox = $('#alert');

    const startBtn = $('#startBtn');

    const form = $('#prosForm');



    // لو أنت على netlify.app نستخدم مسار نسبي، غير ذلك نستخدم دومين netlify مباشرة

    const NETLIFY_BASE = location.hostname.endsWith('netlify.app') ? '' : 'https://probuildzone.netlify.app';



    function showError(msg){

      alertBox.textContent = msg;

      alertBox.classList.remove('hidden');

    }

    function clearError(){ alertBox.classList.add('hidden'); alertBox.textContent=''; }



    async function startTrial(){

      clearError();



      const payload = {

        name: $('#name').value.trim(),

        email: $('#email').value.trim(),

        phone: $('#phone').value.trim(),

        address: $('#address').value.trim(),

        license: $('#license').value.trim(),

        insurance: $('#insurance').value,

        notes: $('#notes').value.trim(),

      };



      if(!payload.name || !payload.email || !payload.phone || !payload.license){

        showError('Please fill name, email, phone, and license.');

        return;

      }



      startBtn.disabled = true; startBtn.textContent = 'Creating session...';



      try{

        const res = await fetch(`${NETLIFY_BASE}/.netlify/functions/create-checkout-session`, {

          method: 'POST',

          headers: { 'Content-Type': 'application/json' },

          body: JSON.stringify(payload)

        });



        if(!res.ok){

          const text = await res.text();

          showError('Failed to fetch session: ' + text);

          return;

        }



        const data = await res.json();

        if(data && data.url){

          window.location.href = data.url; // فتح Stripe Checkout

        } else {

          showError('No session URL returned.');

        }

      } catch(err){

        showError('Error: ' + err.message);

      } finally{

        startBtn.disabled = false; startBtn.textContent = 'Start Free Trial';

      }

    }



    startBtn.addEventListener('click', (e)=>{ e.preventDefault(); startTrial(); });

    form.addEventListener('submit', (e)=> e.preventDefault()); // أمان إضافي

  </script>

</body>

</html>
