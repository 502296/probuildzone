<!doctype html>

<html lang="en" dir="ltr">

<head>

  <meta charset="utf-8" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>ProBuildZone — For Pros</title>

  <meta name="description" content="ProBuildZone Pro Onboarding">

  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

  .agree{

  display:flex; align-items:center; gap:10px;

  color:var(--muted); font-size:13px;

}

.agree input{ margin:0; accent-color: var(--gold); }

.agree a{ font-weight:700; }



@media (max-width:860px){

  form{ grid-template-columns:1fr; }

  .actions{ flex-direction:column; align-items:stretch; }

}

  <style>

    :root{

      --pbz-blue:#0F2A43;

      --ink:#173047;

      --muted:#5f7286;

      --card:#ffffff;

      --line:#dbe7f5;

      --focus:rgba(62,168,255,.25);



      /* الذهبي للزر */

      --gold:#f4c045;

      --gold-hover:#ffd876;

      --gold-text:#0f2a43;



      /* خلفيات */

      --sky-50:#f0f7ff;

      --sky-100:#e1f0ff;

    }

    *{box-sizing:border-box}

    html,body{height:100%}

    body{

      margin:0; font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;

      background:linear-gradient(180deg, var(--sky-50), var(--sky-100));

      color:var(--ink);

    }

    a{color:inherit;text-decoration:none}

    header{position:sticky;top:0;z-index:30;background:rgba(255,255,255,.85);backdrop-filter:blur(6px);border-bottom:1px solid var(--line)}

    .nav{max-width:1080px;margin:0 auto;display:flex;align-items:center;gap:14px;padding:14px 18px}

    .brand{display:flex;align-items:center;gap:12px;font-weight:800}

    .brand img{height:40px;width:auto;display:block;border-radius:8px}

    .brand .name{font-size:20px;color:var(--pbz-blue)}

    main{padding:26px 16px}

    .wrap{max-width:1080px;margin:0 auto;display:grid;gap:20px}

    .hero-card{background:linear-gradient(180deg, var(--sky-100), #fff);border:1px solid var(--line);border-radius:16px;padding:22px 20px;box-shadow:0 10px 28px rgba(31,147,245,.10)}

    .hero-card h1{margin:0 0 6px;font-size:26px;line-height:1.2;color:var(--pbz-blue)}

    .card{background:var(--card);border:1px solid var(--line);border-radius:16px;box-shadow:0 12px 36px rgba(31,147,245,.08)}

    .form{padding:20px}

    form{display:grid;grid-template-columns:1fr 1fr;gap:14px}

    label{font-size:13px;font-weight:700;color:var(--pbz-blue)}

    input,textarea{

      width:100%;padding:12px;border:1px solid #cfe1f5;border-radius:12px;background:#fff;color:#102538;font-size:14px;outline:none

    }

    input:focus,textarea:focus{border-color:#9ec9ff;box-shadow:0 0 0 3px var(--focus)}

    textarea{min-height:110px;resize:vertical;grid-column:span 2}

    .row-2{grid-column:span 2}

    .insurance-row{grid-column:span 2;display:flex;align-items:center;gap:10px;padding-top:2px}

    .insurance-row input{width:auto;accent-color:#1f93f5}

    .actions{grid-column:span 2;display:flex;flex-wrap:wrap;justify-content:space-between;align-items:center;gap:12px;margin-top:6px}

    .hint{color:var(--muted);font-size:13px;display:flex;align-items:center;gap:8px}

    .agree{display:flex;align-items:center;gap:8px}

    .agree input{accent-color:var(--gold)}

    .btn{

      display:inline-flex;align-items:center;justify-content:center;gap:10px;

      padding:14px 18px;border-radius:14px;border:1px solid #cfe1f5;cursor:pointer;font-weight:800;letter-spacing:.2px;background:#fff;

      transition:transform .05s ease, box-shadow .15s ease, background .15s ease, opacity .15s ease;

    }

    .btn-primary{

      background:var(--gold); color:var(--gold-text); border:0;

      box-shadow:0 10px 24px rgba(244,192,69,.35)

    }

    .btn-primary:hover{transform:translateY(-1px); background:var(--gold-hover)}

    .btn-primary:active{transform:translateY(1px)}

    .btn-primary[disabled]{opacity:.55; cursor:not-allowed; transform:none}

    .footer{max-width:1080px;margin:26px auto 6px;color:var(--muted);font-size:12.5px;text-align:center}

    .toast{

      position:fixed;left:50%;bottom:18px;transform:translateX(-50%);

      background:#9b1c1c;color:#fff;padding:12px 14px;border-radius:10px;box-shadow:0 10px 24px rgba(0,0,0,.18);

      opacity:0;pointer-events:none;transition:.3s ease;z-index:40

    }

    .toast.show{opacity:1;pointer-events:auto}

    @media (max-width:860px){

      form{grid-template-columns:1fr}

      textarea{grid-column:span 1}

      .actions{flex-direction:column;align-items:stretch}

    }

  </style>

</head>

<body>

  <header>

    <div class="nav">

      <a class="brand" href="/">

        <img src="LOGO_URL" alt="ProBuildZone Logo" onerror="this.style.display='none'">

        <div class="name">ProBuildZone</div>

      </a>

    </div>

  </header>



  <main>

    <div class="wrap">

      <section class="hero-card">

        <h1>Join ProBuildZone — Get Local Jobs</h1>

        <p>Start your <b>30-day free trial</b>. Monthly plan after trial — cancel anytime during the trial.</p>

      </section>



      <section class="card form">

        <form id="proForm" autocomplete="on" novalidate>

          <div>

            <label for="company">Company Name</label>

            <input id="company" name="company" placeholder="e.g., Bluegrass Builders LLC" required>

          </div>

          <div>

            <label for="fullName">Your Name</label>

            <input id="fullName" name="fullName" placeholder="Full name" required>

          </div>



          <div>

            <label for="email">Email</label>

            <input id="email" name="email" type="email" inputmode="email" placeholder="you@company.com" required>

          </div>

          <div>

            <label for="phone">Phone</label>

            <input id="phone" name="phone" type="tel" inputmode="tel" placeholder="(502) 555-0123">

          </div>



          <div class="row-2">

            <label for="address">Business Address</label>

            <input id="address" name="address" placeholder="Street, City, State">

          </div>



          <div>

            <label for="businessLicense">Business License / #</label>

            <input id="businessLicense" name="businessLicense" placeholder="License number (if applicable)">

          </div>



          <div class="insurance-row">

            <input id="insurance" name="insurance" type="checkbox">

            <label for="insurance">I have active liability insurance</label>

          </div>



          <div class="row-2">

            <label for="notes">Notes (Optional)</label>

            <textarea id="notes" name="notes" placeholder="Tell homeowners what you specialize in..."></textarea>

          </div>



          <div class="actions">

            <div class="hint">

              <label class="agree">

                <input id="agree" type="checkbox" aria-describedby="termsNote">

                <span>By starting your free trial, you agree to our <a href="/terms.html" target="_blank" rel="noopener">Terms</a> &amp; <a href="/privacy.html" target="_blank" rel="noopener">Privacy</a>.</span>

              </label>

            </div>

            <div>

              <button class="btn" type="reset">Reset</button>

              <button class="btn btn-primary" id="startTrial" type="button" disabled>Start Free Trial</button>

            </div>

          </div>

        </form>

      </section>

    </div>

    <div class="footer">© <span id="year"></span> ProBuildZone — Fair Prices · Local Pros</div>

  </main>



  <div id="toast" class="toast" role="status" aria-live="polite"></div>



  <script>

    document.getElementById('year').textContent = new Date().getFullYear();



    const toast = document.getElementById('toast');

    function showToast(msg, ok=false){

      toast.textContent = msg;

      toast.style.background = ok ? '#0F2A43' : '#9b1c1c';

      toast.classList.add('show');

      setTimeout(()=> toast.classList.remove('show'), 2400);

    }



    // تفعيل/تعطيل الزر حسب Checkbox الموافقة

    const agree = document.getElementById('agree');

    const btn   = document.getElementById('startTrial');

    agree.addEventListener('change', ()=> { btn.disabled = !agree.checked; });



    // دالة تستدعي Netlify Function وتُظهر سبب الخطأ الحقيقي

    async function createStripeSession(payload){

      const r = await fetch('/.netlify/functions/create-checkout-session', {

        method:'POST',

        headers:{'Content-Type':'application/json'},

        body: JSON.stringify(payload || {})

      });

      const text = await r.text();

      if(!r.ok){

        console.error('create-session failed', r.status, text);

        throw new Error(`Could not start checkout (${r.status}).`);

      }

      try{ return JSON.parse(text); }catch(e){ return {}; }

    }



    const form = document.getElementById('proForm');



    btn.addEventListener('click', async (e)=>{

      e.preventDefault();

      if(btn.disabled) return;

      btn.disabled = true; const prev = btn.textContent; btn.textContent = 'Please wait…';



      try{

        const company = form.company?.value?.trim() || '';

        const fullName = form.fullName?.value?.trim() || '';

        const email = form.email?.value?.trim() || '';

        if(!company || !fullName || !email){

          showToast('Please complete Company, Name and Email.', false);

          btn.disabled = !agree.checked; btn.textContent = prev; return;

        }

        if(!agree.checked){

          showToast('Please agree to the Terms & Privacy to continue.', false);

          btn.disabled = false; btn.textContent = prev; return;

        }



        // خزّن بيانات النموذج مؤقتًا قبل التحويل الى Stripe

        const payloadToSave = {

          biz: company,

          name: fullName,

          email: email,

          phone: form.phone?.value?.trim() || '',

          address: form.address?.value?.trim() || '',

          license: form.businessLicense?.value?.trim() || '',

          insurance: form.insurance?.checked ? 'YES' : 'NO',

          notes: form.notes?.value?.trim() || '',

          status: 'trial_active'

        };

        sessionStorage.setItem('pbz_profile', JSON.stringify(payloadToSave));



        // أنشئ جلسة Stripe

        const session = await createStripeSession({ email });

        if(session?.url){

          location.href = session.url;

        }else{

          showToast('Could not start checkout. Please try again.', false);

          btn.disabled = !agree.checked; btn.textContent = prev;

        }

      }catch(err){

        console.error(err);

        showToast(err.message || 'Something went wrong. Please try again.', false);

        btn.disabled = !agree.checked; btn.textContent = 'Start Free Trial';

      }

    });

  </script>

</body>

</html>
