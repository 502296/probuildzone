<!doctype html>

<html lang="en">

<head>

  <meta charset="utf-8"/>

  <meta name="viewport" content="width=device-width, initial-scale=1"/>

  <title>ProBuildZone – For Pros</title>

  <style>

    :root{

      --bg:#0f2a43; --panel:#0b1f31; --line:#1b3e60; --muted:#9fb6c9;

      --accent:#F28C1B; --accent-ink:#0f2a43;

    }

    *{box-sizing:border-box}

    html,body{height:100%}

    body{margin:0;font-family:Inter,system-ui,Arial,sans-serif;background:var(--bg);color:#fff}

    a{color:var(--accent)}

    .container{max-width:980px;margin:0 auto;padding:24px}

    header{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}

    .brand{font-weight:800;letter-spacing:.3px}

    .hero{display:grid;gap:14px;margin:28px 0}

    .card{background:var(--panel);border:1px solid var(--line);border-radius:14px;padding:20px}

    .btn{padding:12px 18px;border:1px solid #365b7a;border-radius:10px;background:#0b1f31;color:#fff;cursor:pointer}

    .btn-primary{background:var(--accent);border-color:var(--accent);color:var(--accent-ink);font-weight:800}

    .btn[disabled]{opacity:.6;cursor:not-allowed}

    .subtle{color:var(--muted);font-size:.95rem}

    .badges{display:flex;gap:10px;align-items:center;margin-top:6px;font-size:.9rem;color:var(--muted)}

    .lock{display:inline-flex;align-items:center;gap:8px}

    .lock svg{width:16px;height:16px;opacity:.9}



    .modal[hidden]{display:none}

    .modal{position:fixed;inset:0;display:grid;place-items:center;background:#0008;z-index:9999;padding:16px}

    .modal-card{

      background:var(--bg);color:#fff;border-radius:14px;border:1px solid var(--line);

      width:min(700px,100%);max-height:90vh;display:flex;flex-direction:column;

    }

    .modal-header{display:flex;justify-content:space-between;align-items:center;padding:16px 20px;border-bottom:1px solid var(--line)}

    .step{display:inline-block;padding:6px 10px;border-radius:20px;border:1px solid var(--line);font-size:.85rem;color:var(--muted)}

    .title{margin:6px 20px 0 20px}

    .modal-body{padding:16px 20px;overflow:auto}

    .grid{display:grid;gap:12px;margin:16px 0}

    @media(min-width:720px){ .grid.cols-2{grid-template-columns:1fr 1fr} }

    label{display:grid;gap:6px;font-size:.95rem}

    input,select,textarea{padding:10px;border:1px solid #365b7a;border-radius:8px;background:#0b1f31;color:#fff}

    textarea{min-height:80px;resize:vertical}

    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}



    .actions-wrap{

      position:sticky;bottom:0;background:linear-gradient(180deg, rgba(15,42,67,0.92), rgba(15,42,67,1));

      border-top:1px solid var(--line);padding:12px 20px;margin-top:auto;

      padding-bottom: calc(12px + env(safe-area-inset-bottom, 0));

    }

    .actions{display:flex;gap:10px;justify-content:space-between;align-items:center}

    .actions-right{display:flex;gap:10px}

    .msg{margin-top:10px;font-size:.9rem}

    .muted{color:var(--muted);font-size:.9rem}

    .badge{border:1px solid var(--line);border-radius:999px;padding:4px 10px;color:var(--muted);font-size:.85rem}

  </style>

</head>



<body>

  <div class="container">

    <header>

      <div class="brand">ProBuildZone</div>

      <nav><a href="/" class="btn">Home</a></nav>

    </header>



    <section class="hero">

      <div class="card">

        <h1>Grow your business with ProBuildZone</h1>

        <p class="subtle">Start your <strong>30-day free trial</strong>. Annual plan – cancel anytime before trial ends.</p>

        <div class="badges">

          <span class="lock">

            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 1a5 5 0 00-5 5v3H6a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2v-8a2 2 0 00-2-2h-1V6a5 5 0 00-5-5zm-3 8V6a3 3 0 116 0v3H9z"/></svg>

            Secure checkout by Stripe

          </span>

          <span class="badge">No setup fees</span>

          <span class="badge">Cancel anytime</span>

        </div>

        <div style="margin-top:14px">

          <button id="startTrialBtn" class="btn btn-primary" type="button">Start Free Trial</button>

        </div>

      </div>

    </section>

  </div>



  <!-- Signup Modal -->

  <div id="trialModal" class="modal" hidden>

    <div class="modal-card">

      <div class="modal-header">

        <span class="step">Business Info <strong></strong></span>

      </div>

      <h3 class="title">Start your 30-day free trial</h3>



      <form id="trialForm" style="display:flex;flex-direction:column;min-height:0">

        <div class="modal-body" id="scrollArea">

          <div class="grid cols-2">

            <label>Company Name

              <input name="company" required placeholder="e.g., Royal Builders LLC">

            </label>

            <label>Company Website (optional)

              <input name="website" placeholder="https://yourcompany.com">

            </label>



            <label>Business Category

              <select name="category" required>

                <option value="" selected disabled>Select…</option>

                <option>General Contractor</option>

                <option>Porch/Deck Builder</option>

                <option>Roofing</option>

                <option>Flooring</option>

                <option>Painting</option>

                <option>Landscaping</option>

                <option>Handyman</option>

                <option>Other</option>

              </select>

            </label>



            <label>Business License

              <input name="business_license" required placeholder="License number / state">

            </label>

          </div>



          <div class="grid cols-2">

            <label>Full Name

              <input name="name" required placeholder="Your name">

            </label>

            <label>Email

              <input type="email" name="email" required placeholder="name@company.com">

            </label>

            <label>Phone

              <input name="phone" required placeholder="+1 (502) 555-1234">

            </label>

            <label>Address

              <input name="address" required placeholder="Street, City, State">

            </label>

          </div>



          <label>Service Areas (cities or ZIPs)

            <textarea name="service_areas" placeholder="Louisville, Jefferson County, 40214…"></textarea>

          </label>



          <div class="grid">

            <label class="row" style="gap:8px">

              <input type="checkbox" id="hasInsurance" name="has_insurance">

              <span class="muted">We carry general liability insurance</span>

            </label>

            <div id="insuranceDetails" class="grid cols-2" style="display:none">

              <label>Insurance Carrier (optional)

                <input name="insurance_carrier" placeholder="e.g., State Farm">

              </label>

              <label>Policy # (optional)

                <input name="insurance_policy" placeholder="e.g., GL-123456">

              </label>

            </div>

          </div>



          <div class="row">

            <label class="row" style="gap:8px">

              <input type="checkbox" name="accept_terms" required>

              <span class="muted">I agree to the <a href="#">Terms</a> and <a href="#">Privacy Policy</a>.</span>

            </label>

          </div>

        </div>



        <!-- sticky action bar -->

        <div class="actions-wrap">

          <div class="actions">

            <span class="muted lock">

              <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 1a5 5 0 00-5 5v3H6a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2v-8a2 2 0 00-2-2h-1V6a5 5 0 00-5-5zm-3 8V6a3 3 0 116 0v3H9z"/></svg>

              Card details are collected securely on Stripe.

            </span>

            <div class="actions-right">

              <button type="button" id="cancelTrial" class="btn">Cancel</button>

              <button type="button" id="payBtn" class="btn btn-primary" onclick="submitProsAndPay(event)">Continue to Secure Payment</button>

            </div>

          </div>

          <p id="trialMsg" class="msg" aria-live="polite"></p>

        </div>

      </form>

    </div>

  </div>



  <!-- Original script -->

  <script type="module">

    const $ = (s, p=document) => p.querySelector(s);

    const openModal = ()=> { $("#trialModal").hidden = false; };

    const closeModal = ()=> { $("#trialModal").hidden = true; };

    const serializeForm = (form)=>{

      const data = new FormData(form);

      return Object.fromEntries([...data.entries()].map(([k,v])=>[k, typeof v==="string"? v.trim(): v]));

    };

    async function postJSON(url, payload){

      const res = await fetch(url, {

        method: "POST",

        headers: {"Content-Type": "application/json"},

        body: JSON.stringify(payload)

      });

      if(!res.ok){

        const text = await res.text().catch(()=> "");

        throw new Error(text || `Request failed: ${res.status}`);

      }

      return res.json();

    }

    function setLoading(b){

      $("#submitTrial").disabled = b;

      $("#startTrialBtn")?.setAttribute("aria-busy", b ? "true" : "false");

    }

    $("#startTrialBtn")?.addEventListener("click", () => { openModal(); $("#trialMsg").textContent = ""; });

    $("#cancelTrial")?.addEventListener("click", () => closeModal());

    $("#trialModal")?.addEventListener("click",(e)=>{ if(e.target.id === "trialModal") closeModal(); });

    $("#hasInsurance")?.addEventListener("change", (e)=>{

      const box = $("#insuranceDetails");

      if(box){ box.style.display = e.currentTarget.checked ? "grid" : "none"; }

    });

  </script>



  <!-- Added payment script -->

  <script>

    async function submitProsAndPay(e){

      e.preventDefault();

      const btn = document.getElementById('payBtn');

      const msg = document.getElementById('trialMsg');

      const formEl = document.getElementById('trialForm');

      btn.disabled = true;

      msg.textContent = '';

      const fd = new FormData(formEl);

      const payload = Object.fromEntries([...fd.entries()].map(([k,v])=>[k, typeof v==="string"? v.trim(): v]));

      payload.has_insurance = formEl.querySelector('#hasInsurance')?.checked || false;



      try {

        const saveRes = await fetch('/api/pros/create', {

          method: 'POST',

          headers: {'Content-Type':'application/json'},

          body: JSON.stringify(payload)

        });

        const saveJson = await saveRes.json().catch(()=> ({}));

        if(!saveRes.ok || (saveJson && saveJson.ok === false)){

          throw new Error('Saving failed');

        }



        const stripeRes = await fetch('/api/stripe/create-checkout-session', {

          method: 'POST',

          headers: {'Content-Type':'application/json'},

          body: JSON.stringify(payload)

        });

        const stripeJson = await stripeRes.json();

        if(!stripeRes.ok || !stripeJson.checkoutUrl){

          throw new Error(stripeJson.error || 'Stripe error');

        }

        window.location.href = stripeJson.checkoutUrl;



      } catch (err) {

        console.error(err);

        msg.textContent = 'Something went wrong. Please try again.';

        btn.disabled = false;

      }

    }

  </script>

</body>

</html>
