<!doctype html>

<html lang="en">

<head>

  <meta charset="utf-8"/>

  <meta name="viewport" content="width=device-width, initial-scale=1"/>

  <title>For Pros – Subscribe | $25/month</title>



  <!-- نمط بسيط وأنيق؛ عدّل الألوان إن رغبت -->

  <style>

    * { box-sizing: border-box; }

    body {

      margin: 0;

      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;

      background: #0f2a43;

      color: #f7f9fc;

      -webkit-font-smoothing: antialiased;

      -moz-osx-font-smoothing: grayscale;

    }

    a { color: #f7f9fc; }



    .wrap {

      min-height: 100dvh;

      display: grid;

      place-items: center;

      padding: 24px;

    }



    .card {

      width: 100%;

      max-width: 760px;

      background: #142b3f;

      border: 1px solid rgba(255,255,255,0.08);

      border-radius: 14px;

      box-shadow: 0 10px 30px rgba(0,0,0,.35);

      overflow: hidden;

    }



    .header {

      padding: 18px 22px;

      background: linear-gradient(180deg, #183650, #142b3f);

      border-bottom: 1px solid rgba(255,255,255,0.06);

      display: flex;

      align-items: center;

      justify-content: space-between;

      gap: 12px;

    }

    .header h1 {

      font-size: 20px;

      margin: 0;

      letter-spacing: .3px;

      font-weight: 700;

    }

    .plan {

      font-size: 13px;

      opacity: .9;

    }



    .body {

      padding: 22px;

      display: grid;

      gap: 18px;

    }



    .grid {

      display: grid;

      gap: 14px;

    }

    @media (min-width: 720px) {

      .grid-2 { grid-template-columns: 1fr 1fr; }

      .grid-3 { grid-template-columns: 1fr 1fr 1fr; }

    }



    label {

      display: block;

      font-size: 13px;

      margin-bottom: 6px;

      opacity: .9;

    }

    input {

      width: 100%;

      height: 44px;

      border-radius: 10px;

      border: 1px solid rgba(255,255,255,0.15);

      background: rgba(255,255,255,0.06);

      color: #fff;

      padding: 0 12px;

      outline: none;

    }

    input::placeholder { color: rgba(255,255,255,0.55); }



    .hint {

      font-size: 12px;

      opacity: .8;

    }



    .footer {

      padding: 20px 22px;

      display: flex;

      gap: 12px;

      align-items: center;

      justify-content: space-between;

      border-top: 1px solid rgba(255,255,255,0.06);

      background: #12283a;

      flex-wrap: wrap;

    }



    .btn {

      appearance: none;

      border: 0;

      border-radius: 12px;

      padding: 12px 18px;

      font-weight: 700;

      cursor: pointer;

      transition: transform .05s ease, box-shadow .2s ease, opacity .2s ease;

      white-space: nowrap;

    }

    .btn-primary {

      background: #F28C1B;

      color: #0f2a43;

      box-shadow: 0 6px 18px rgba(242,140,27,.35);

    }

    .btn-primary:active { transform: translateY(1px) scale(.99); }

    .btn[disabled] {

      opacity: .6;

      pointer-events: none;

    }



    .price-line {

      font-weight: 700;

      letter-spacing: .3px;

    }



    .spinner {

      display: inline-block;

      width: 16px; height: 16px;

      border: 2px solid rgba(255,255,255,.35);

      border-top-color: #fff;

      border-radius: 50%;

      animation: spin 1s linear infinite;

      vertical-align: -3px;

      margin-inline-start: 8px;

      visibility: hidden;

    }

    @keyframes spin { to { transform: rotate(360deg); } }



    .note {

      font-size: 12px;

      opacity: .8;

    }

    .ok { color: #9ff1c3; }

    .err { color: #ffb3b3; }

  </style>

</head>

<body>

  <div class="wrap">

    <div class="card" role="region" aria-labelledby="cardTitle">

      <div class="header">

        <h1 id="cardTitle">Pro Subscription</h1>

        <div class="plan">$25/month <span class="hint">(+ optional free trial)</span></div>

      </div>



      <form id="pros-form" class="body" novalidate>

        <div class="grid grid-2">

          <div>

            <label for="name">Full Name *</label>

            <input id="name" name="name" type="text" placeholder="Your full name" required />

          </div>

          <div>

            <label for="company">Business / Company</label>

            <input id="company" name="company" type="text" placeholder="Your business name" />

          </div>

        </div>



        <div class="grid grid-2">

          <div>

            <label for="email">Email *</label>

            <input id="email" name="email" type="email" inputmode="email" placeholder="you@example.com" required />

          </div>

          <div>

            <label for="phone">Phone</label>

            <input id="phone" name="phone" type="tel" inputmode="tel" placeholder="+1 (___) ___-____" />

          </div>

        </div>



        <div class="grid">

          <div>

            <label for="address">Street Address</label>

            <input id="address" name="address" type="text" placeholder="123 Main St" />

          </div>

        </div>



        <div class="grid grid-3">

          <div>

            <label for="city">City</label>

            <input id="city" name="city" type="text" placeholder="City" />

          </div>

          <div>

            <label for="state">State</label>

            <input id="state" name="state" type="text" placeholder="KY" />

          </div>

          <div>

            <label for="zip">ZIP</label>

            <input id="zip" name="zip" type="text" inputmode="numeric" placeholder="402XX" />

          </div>

        </div>



        <p class="hint">

          By clicking “Continue to Secure Payment”, you’ll be redirected to Stripe Checkout to complete your

          <span class="price-line">$25/month</span> subscription.

        </p>

      </form>



      <div class="footer">

        <div class="note">

          <span id="status" class="ok" aria-live="polite"></span>

        </div>

        <div>

          <button id="pay-btn" class="btn btn-primary">

            Continue to Secure Payment

            <span id="spin" class="spinner" aria-hidden="true"></span>

          </button>

        </div>

      </div>

    </div>

  </div>



  <!-- سكربت الاستدعاء إلى API: يرسل بيانات النموذج ثم يوجّه إلى Stripe -->

  <script>

    const form = document.getElementById('pros-form');

    const payBtn = document.getElementById('pay-btn');

    const spin = document.getElementById('spin');

    const statusEl = document.getElementById('status');



    function setLoading(loading) {

      if (loading) {

        payBtn.setAttribute('disabled', 'true');

        spin.style.visibility = 'visible';

      } else {

        payBtn.removeAttribute('disabled');

        spin.style.visibility = 'hidden';

      }

    }



    function getPayload() {

      return {

        email:   document.querySelector('#email')?.value?.trim() || '',

        name:    document.querySelector('#name')?.value?.trim() || '',

        company: document.querySelector('#company')?.value?.trim() || '',

        phone:   document.querySelector('#phone')?.value?.trim() || '',

        address: document.querySelector('#address')?.value?.trim() || '',

        city:    document.querySelector('#city')?.value?.trim() || '',

        state:   document.querySelector('#state')?.value?.trim() || '',

        zip:     document.querySelector('#zip')?.value?.trim() || '',

      };

    }



    function validateRequired() {

      // حقول أساسية: الاسم + الإيميل

      const email = document.getElementById('email');

      const name  = document.getElementById('name');

      let ok = true;



      if (!name.value.trim()) {

        name.focus();

        ok = false;

      } else if (!email.value.trim() || !email.validity.valid) {

        email.focus();

        ok = false;

      }

      return ok;

    }



    payBtn.addEventListener('click', async (e) => {

      e.preventDefault();

      statusEl.textContent = '';

      if (!validateRequired()) {

        statusEl.textContent = 'Please fill the required fields (Name & Email).';

        statusEl.className = 'note err';

        return;

      }



      setLoading(true);

      try {

        const payload = getPayload();



        const res = await fetch('/api/stripe/create-checkout-session', {

          method: 'POST',

          headers: { 'Content-Type': 'application/json' },

          body: JSON.stringify(payload),

        });



        const data = await res.json();



        if (!res.ok) {

          statusEl.textContent = data?.error || 'Something went wrong. Please try again.';

          statusEl.className = 'note err';

          setLoading(false);

          return;

        }



        if (data?.url) {

          statusEl.textContent = 'Redirecting to secure payment…';

          statusEl.className = 'note ok';

          window.location.href = data.url; // تحويل إلى Stripe Checkout

        } else {

          statusEl.textContent = 'No checkout URL returned.';

          statusEl.className = 'note err';

          setLoading(false);

        }

      } catch (err) {

        console.error(err);

        statusEl.textContent = 'Network error. Please try again.';

        statusEl.className = 'note err';

        setLoading(false);

      }

    });

  </script>

</body>

</html>
